<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>å¹¹è©±ç”Ÿæˆå™¨ Pro â€” æœ¬åœ°/AIã€é—œéµå­—åµŒå…¥ã€æˆäººæ¨¡å¼ã€åœ–ç‰‡å°å‡º</title>
  <meta name="description" content="é›™æ¨¡å¹¹è©±ç”Ÿæˆå™¨ï¼šè±å¯Œèªæ–™èˆ‡æ¨¡æ¿ã€æˆäººæ¨¡å¼ï¼ˆé›™é—œ/éœ²éª¨ 18+ï¼‰ã€AI é è¨­æç¤ºè©ã€é—œéµå­—åµŒå…¥ã€åœ–ç‰‡å°å‡ºï¼ˆé«˜è§£æã€å¯èª¿æ’ç‰ˆï¼‰ã€‚" />
  <link rel="stylesheet" href="talkshit.css" />
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>å¹¹è©±ç”Ÿæˆå™¨ Pro</h1>
          <small>é›™æ¨¡ Ã— ä¸»é¡Œ Ã— é—œéµå­— Ã— æˆäººæ¨¡å¼ Ã— é«˜ç•«è³ªåœ–ç‰‡</small>
        </div>
      </div>
      <div class="switches">
        <div class="switch">
          <details id="aiDetails">
            <summary>AI æ¨¡å¼</summary>
            <div class="popover">
              <div class="row-compact">
                <div class="switch"><input type="checkbox" id="aiEnabled" /><label for="aiEnabled">å•Ÿç”¨ AI</label></div>
                <div>
                  <label>API Key</label>
                  <input id="apiKey" type="password" placeholder="sk-****************" />
                </div>
                <details class="more">
                  <summary>æ›´å¤šè¨­å®š</summary>
                  <div class="grid-2">
                    <div>
                      <label>API Base URL</label>
                      <input id="apiBase" type="text" value="https://api.openai.com/v1" />
                    </div>
                    <div>
                      <label>Model</label>
                      <input id="apiModel" type="text" value="gpt-4o-mini" />
                    </div>
                    <div>
                      <label>å¥æ•¸</label>
                      <input id="aiCount" type="number" min="1" max="20" value="6" />
                    </div>
                    <div>
                      <label>å‰µæ„åº¦ï¼ˆtemperatureï¼‰</label>
                      <input id="aiTemp" type="range" min="0" max="100" value="70" />
                    </div>
                    <div>
                      <label>å»é‡</label>
                      <select id="aiDedupe">
                        <option value="soft">é©åº¦</option>
                        <option value="strict">åš´æ ¼</option>
            <option value="off">é—œé–‰</option>
          </select>
                    </div>
                  </div>
                </details>
              </div>
            </div>
          </details>
        </div>
        <div class="switch">
          <details id="adultDetails">
            <summary>æˆäººæ¨¡å¼ï¼ˆ18+ï¼‰</summary>
            <div class="popover">
              <div class="switch"><input type="checkbox" id="adultOn" /><label for="adultOn">å•Ÿç”¨æˆäººæ¨¡å¼</label></div>
              <div class="switch"><input type="checkbox" id="adultFull" /><label for="adultFull">ç«åŠ›å…¨é–‹ï¼ˆæœ€éœ²éª¨ï¼‰</label></div>
              <label>è‡ªè¨‚æˆäºº System æç¤ºè©ï¼ˆå¯ç•™ç©ºï¼Œå¦å«é è¨­æ–¼ prompts.jsï¼‰</label>
              <textarea id="adultCustomPrompt" placeholder="åœ¨æ­¤è¦†å¯«æˆäººé è¨­æç¤ºè©"></textarea>
        </div>
          </details>
      </div>

      </div>
    </header>

    <div class="card">
      <div id="panel-local" class="panel">
        <div class="controls">
          <div class="col-6">
            <label>ä¸»é¡Œåˆ†é¡</label>
            <select id="theme">
              <optgroup label="ä¸€èˆ¬">
                <option value="random">éš¨æ©Ÿ</option>
                <option value="custom">è‡ªå®šç¾©</option>
                <option value="å“²ç†é›æ¹¯">å“²ç†é›æ¹¯</option>
                <option value="ç¤¾æœƒå†·ç¬‘è©±">ç¤¾æœƒå†·ç¬‘è©±</option>
                <option value="æƒ…æ„Ÿ">æƒ…æ„Ÿ</option>
                <option value="è‡ªå˜²">è‡ªå˜²</option>
                <option value="è·å ´">è·å ´</option>
                <option value="äººç”Ÿ">äººç”Ÿ</option>
                <option value="å‹æƒ…">å‹æƒ…</option>
                <option value="æŠ¼éŸ»å°ä»—">æŠ¼éŸ»å°ä»—</option>
                <option value="ç§‘æŠ€å®…">ç§‘æŠ€å®…</option>
                <option value="é›»ç«¶éŠæˆ²">é›»ç«¶/éŠæˆ²</option>
                <option value="å¥èº«">å¥èº«</option>
                <option value="ç†è²¡">ç†è²¡</option>
                <option value="æ—…è¡Œ">æ—…è¡Œ</option>
                <option value="ç¾é£Ÿ">ç¾é£Ÿ</option>
                <option value="æ ¡åœ’ç•¢æ¥­">æ ¡åœ’/ç•¢æ¥­</option>
                <option value="è¿·å› å­¸">è¿·å› å­¸</option>
                <option value="æ¯’é›æ¹¯">æ¯’é›æ¹¯ï¼ˆè¾›è¾£ï¼‰</option>
                <option value="ç¤¾ç¾¤åª’é«”">ç¤¾ç¾¤åª’é«”</option>
                <option value="å…§è€—">å…§è€—</option>
                <option value="é€šå‹¤">é€šå‹¤</option>
                <option value="ä¸Šç­æ‘¸é­š">ä¸Šç­æ‘¸é­š</option>
                <option value="é¢è©¦">é¢è©¦</option>
                <option value="å‰µæ¥­">å‰µæ¥­</option>
                <option value="ç†¬å¤œæ—©å…«">ç†¬å¤œ/æ—©å…«</option>
                <option value="é¤Šç”Ÿ">é¤Šç”Ÿ</option>
                <option value="å’–å•¡">å’–å•¡</option>
                <option value="æ›¸å½±éŸ³">æ›¸å½±éŸ³</option>
                <option value="å°ˆæ¡ˆç®¡ç†">å°ˆæ¡ˆç®¡ç†</option>
              </optgroup>
              <optgroup label="æˆäººï¼ˆéœ€é–‹å•Ÿæˆäººæ¨¡å¼ï¼‰">
                <option value="æˆäºº-é›™é—œ">æˆäºº-é›™é—œ</option>
                <option value="æˆäºº-éœ²éª¨">æˆäºº-éœ²éª¨ï¼ˆ18+ï¼‰</option>
              </optgroup>
            </select>
            <small class="muted">æˆäººä¸»é¡Œéœ€é–‹å•Ÿä¸Šæ–¹ã€Œæˆäººæ¨¡å¼ã€</small>
          </div>
          <div class="col-6">
            <label>è‡ªè¨‚ä¸»é¡Œï¼ˆé¸ã€Œè‡ªå®šç¾©ã€å¾Œå¯è¼¸å…¥ï¼‰</label>
            <input id="themeCustom" type="text" placeholder="ä¾‹å¦‚ï¼šç•¢æ¥­ã€å°¾ç‰™ã€æ¸›è‚¥ã€{æœ‹å‹åå­—}" disabled />
          </div>
          <div class="col-6">
            <label>é—œéµå­—ï¼ˆåè©ï¼‰</label>
            <input id="keyword" type="text" placeholder="ä¾‹å¦‚ï¼šé˜¿å®ã€ä¿æº«ç“¶ã€æ»‘é¼ ã€KPI"/>
          </div>
          <div class="col-6">
            <label>è¼¸å‡ºæ ¼å¼</label>
            <select id="format">
              <option value="single">å–®å¥</option>
              <option value="list">æ¸…å–®ï¼ˆå¤šå¥ï¼‰</option>
              <option value="paragraph">æ®µè½ï¼ˆå¤šå¥åˆæˆï¼‰</option>
              <option value="couplet">å°è¯ï¼ˆä¸Šè¯/ä¸‹è¯ï¼‰</option>
              <option value="poster">æµ·å ±æ–‡æ¡ˆï¼ˆçŸ­å¥ Ã— Nï¼‰</option>
            </select>
          </div>
          <div class="col-6">
            <label>è¼¸å‡ºé¢¨æ ¼</label>
            <select id="style">
              <option value="æ­£å¸¸">æ­£å¸¸</option>
              <option value="custom">è‡ªå®šç¾©</option>
              <option value="è©©æ„">è©©æ„</option>
              <option value="æ¯’èˆŒ">æ¯’èˆŒ</option>
              <option value="å°å‘³">å°å‘³</option>
              <option value="é»‘è‰²å¹½é»˜">é»‘è‰²å¹½é»˜</option>
              <option value="æ–‡é’">æ–‡é’</option>
              <option value="å‹µå¿—">å‹µå¿—</option>
              <option value="å†·é¢">å†·é¢</option>
              <option value="æµ®èª‡">æµ®èª‡</option>
            </select>
          </div>
          <div class="col-6">
            <label>è‡ªå®šç¾©é¢¨æ ¼ï¼ˆé¸ã€Œè‡ªå®šç¾©ã€å¾Œå¯è¼¸å…¥ï¼‰</label>
            <input id="styleCustom" type="text" placeholder="ä¾‹å¦‚ï¼šæ¯’èˆŒã€è©©æ„ã€å°å‘³ã€é»‘è‰²å¹½é»˜" disabled />
          </div>
          <div class="col-4">
            <label id="countLabel">æ•¸é‡/å¥æ•¸</label>
            <input id="count" type="number" min="1" max="20" value="4" />
          </div>
          <div class="col-4">
            <label>å‰µæ„åº¦</label>
            <input id="creativity" type="range" min="0" max="100" value="60" />
            <small class="muted">è¶Šé«˜è¶Šé£›ï¼Œè¶Šä½è¶Šç©©</small>
          </div>
          <div class="col-4">
            <label>è¼¸å‡ºå»é‡</label>
            <select id="dedupe">
              <option value="soft">é©åº¦</option>
              <option value="strict">åš´æ ¼</option>
              <option value="off">é—œé–‰</option>
            </select>
          </div>
          <div class="col-12">
            <small class="muted">æç¤ºï¼šå–®å¥èˆ‡å°è¯æœƒå›ºå®šå¥æ•¸ï¼›æ¸…å–®ã€æ®µè½ã€æµ·å ±æ–‡æ¡ˆæœƒä¾ã€Œæ•¸é‡/å¥æ•¸ã€è¼¸å‡ºã€‚</small>
          </div>
        </div>
        <div class="btns">
          <button class="btn-primary" id="btn-gen-local">ç”Ÿæˆæ–‡å­—</button>
          <button id="btn-rand">éš¨æ©Ÿè¨­å®š</button>
          <button id="btn-clear">æ¸…ç©º</button>
        </div>
      </div>

      
    </div>

    <div class="row">
      <div class="card">
        
        <div class="monitor" aria-live="polite">
          <div class="monitor-top" aria-hidden="true">
            <span class="dot red"></span>
            <span class="dot yellow"></span>
            <span class="dot green"></span>
        </div>
          <div class="screen">
            <pre id="output" class="screen-content"></pre>
          </div>
          </div>
        <div class="btns" style="margin-top:10px">
            <button class="btn-copy" id="btn-copy-all">ä¸€éµè¤‡è£½</button>
          </div>
          </div>

      
    </div>

    <div class="footer">
      <div>
        å°å®åš€ï¼šæœ¬å·¥å…·åƒ…ä¾›å¨›æ¨‚ï¼Œè«‹é¿å…ç”¨æ–¼äººèº«æ”»æ“Šæˆ–é¨·æ“¾ã€‚æˆäººæ¨¡å¼åƒ…é™æˆå¹´äººè‡ªé¡˜æƒ…å¢ƒï¼Œç¦æ­¢æ¶‰åŠæœªæˆå¹´äººã€äº‚å€«ã€ç¸äº¤æˆ–ä»»ä½•éè‡ªé¡˜è¡Œç‚ºã€‚
      </div>
      <div>
        Made with <span class="hl">HTML/CSS/JS</span> Â· æ‰€æœ‰ç”Ÿæˆæ–¼æœ¬åœ°åŸ·è¡Œ
      </div>
    </div>

    <div class="toast" id="toast">å·²è¤‡è£½</div>
  </div>

  <script type="module">
    import { buildSystemPromptFromState } from './prompts.js';
    import { typeLines } from './talkshit.js';
    // =============== å·¥å…·å‡½å¼ ===============
    const $ = (sel)=>document.querySelector(sel);
    const $$ = (sel)=>Array.from(document.querySelectorAll(sel));
    const toast = (msg)=>{const t=$("#toast");t.textContent=msg;t.classList.add("show");setTimeout(()=>t.classList.remove("show"),1200)}
    const toastLoading = (msg)=>{const t=$("#toast");t.textContent=msg;t.classList.add("show","spinner");};
    const toastDone = ()=>{const t=$("#toast");t.classList.remove("spinner");setTimeout(()=>t.classList.remove("show"),400)};
    const rand=(n)=>Math.floor(Math.random()*n);
    const pick=(arr)=>arr[rand(arr.length)];
    const shuffle=(arr)=>arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]);
    const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
    const uniq=(arr)=>Array.from(new Set(arr));
    const sample=(arr,n)=>shuffle(arr).slice(0,Math.min(arr.length,n));
    const byId=(id)=>document.getElementById(id);
    const setLocal=(k,v)=>{ try{ localStorage.setItem(k, JSON.stringify(v)); }catch(e){} };
    const getLocal=(k, def=null)=>{ try{ const v=localStorage.getItem(k); return v? JSON.parse(v): def; }catch(e){ return def; } };
    // æ¨™é»ä¿®å¾©/æ­£è¦åŒ–
    const normalizePunctuation = (s)=>{
      if(!s) return s;
      let out = s;
      // è‹±æ–‡æ¨™é»è½‰å…¨å½¢ä¸­æ–‡ï¼ˆä¿å®ˆè½‰æ›ï¼‰
      out = out.replace(/!/g,'ï¼').replace(/\?/g,'ï¼Ÿ').replace(/,/g,'ï¼Œ').replace(/;/g,'ï¼›');
      // å¥æœ«å¥é»ï¼šå°‡éæ•¸å­—å°æ•¸é»çš„å¥æœ«æˆ–ç©ºç™½å¾Œå¥é»è½‰æ›ç‚ºå…¨å½¢
      out = out.replace(/\.(?=\s|$)/g,'ã€‚');
      // å»é™¤æ¨™é»å‰å¤šé¤˜ç©ºæ ¼
      out = out.replace(/\s+([ï¼Œã€‚ï¼›ï¼ï¼Ÿ])/g,'$1');
      // è‹¥å¥æœ«ç„¡çµå°¾æ¨™é»ï¼Œè£œä¸Šå¥è™Ÿ
      const trimmed = out.trim();
      if(trimmed && !/[ã€‚ï¼ï¼Ÿ!]$/.test(trimmed)) out = trimmed + 'ã€‚';
      return out;
    };
    const sanitizeLines = (lines)=> lines.map((s)=> normalizePunctuation(s));
    const sanitizeTextByFormat = (text, format)=>{
      if(format === 'paragraph') return normalizePunctuation(text);
      const arr = text.split(/\n/).map(normalizePunctuation);
      return arr.join('\n');
    };

    // =============== é—œéµå­—æ›¿æ› ===============
    function replaceSmart(str, map){
      // [a|b|c] éš¨æ©Ÿåˆ†æ”¯
      str = str.replace(/\[([^\]]+)\]/g, (_, inside)=>{
        const opts = inside.split("|").map(s=>s.trim());
        return pick(opts);
      });
      // {å ä½}
      str = str.replace(/\{(\w+)\}/g, (_, k)=>{
        if (map[k] != null && map[k] !== "") return map[k];
        if (k === "KW") return pick(["é€™ä»¶äº‹","é‚£å€‹æ±è¥¿","å®ƒ","æŸå€‹å‚³èªª","é€™æ³¢æ“ä½œ"]);
        if (k === "THEME") return map["THEME"] || "äººç”Ÿ";
        if (k === "NOUN") return pick(LEX.NOUN);
        if (k === "ADJ") return pick(LEX.ADJ);
        if (k === "VERB") return pick(LEX.VERB);
        if (k === "EMOJI") return pick(LEX.EMOJI);
        if (k === "SAFEWORD") return map["KW"] || pick(["é³³æ¢¨","èŠå£«","è–„è·","æµ·é¹½"]);
        return "";
      });
      return str;
    }

    // =============== è©åº« ===============
    const LEX = {
      NOUN: [
        "äººç”Ÿ","ä¸–ç•Œ","ç¤¾æœƒ","ç¾å¯¦","ç†æƒ³","é¸æ“‡","å‘½é‹","é¢¨å‘","åº•ç·š","åŸå‰‡","å¥—è·¯","åŠ‡æƒ…","æ®µä½","åˆå¿ƒ",
        "è¦å‰‡","é‚è¼¯","å„€å¼æ„Ÿ","å¤¢æƒ³","é«”é¢","ç§©åº","ç¯€å¥","èª¤æœƒ","é»˜å¥‘","æ™‚é–“","å¤©è³¦","é‹æ°£","æ ¼å±€","é‡å¿ƒ",
        "KPI","OKR","å ±è¡¨","éˆæ„Ÿ","æµé‡","æƒ…ç·’","å‹æƒ…","æ„›æƒ…","è¨Šè™Ÿ","å›æ†¶","æ®µå­","æ¢—","ç«å€™","åº•è˜Š","æ¨‚å­","ç®—æ³•","é‚Šç•Œ",
        "èº«æç®¡ç†","ç¡çœ å“è³ª","å°ˆæ³¨åŠ›","è‡ªæ§åŠ›","è¼¸å‡º","äººè¨­","æ•˜äº‹","é–€æª»","å·¥ä½","é€±å ±","é€šå‹¤å¡","æœƒè­°å®¤","å’–å•¡å› ","ç†¬å¤œè²»",
        "é«”è„‚ç‡","è¤ªé»‘ç´ ","å°ˆæ¡ˆ","ç”˜ç‰¹åœ–","æ‰“å¡æ©Ÿ","å·¥æ™‚","æƒ…ç·’åƒ¹å€¼","éœ€æ±‚æ–‡æª”","è·¯ç·šåœ–","æŒ‡æ¨™"
      ],
      ADJ: [
        "è¤‡é›œ","é›¢è­œ","æŠ½è±¡","è¼•ç›ˆ","æ²‰é‡","è™›ç„¡","é«”é¢","ç¯¤å®š","å…‹åˆ¶","é€šé€","ç¸å¯†","å¾®å¦™","æµ®èª‡","ç©©é‡","ä¸Šé ­","æ¸…é†’","ä½›ç³»","ç¤¾æ",
        "é«˜å†·","ç†±é¬§","ä¸è¬›ç†","ç„å­¸","éˆæ€§","æŸ”è»Ÿ","ç¡¬æ ¸","ä¿å®ˆ","æ¿€é€²","é€²é€€å…©é›£","è«åå…¶å¦™","èªç„‰ä¸è©³","æ¬²è¨€åˆæ­¢",
        "å«è“„","ç›´æ¥","å°–éŠ³","å¹³éœ","å…‹é›£","é¤Šç”Ÿ","ç„¦æ…®","ä½èª¿","é«˜èª¿","ç¢è£‚","ä¹¾è„†","ç©©å¦¥"
      ],
      VERB: [
        "æ‰›è‘—","æ‹¿æ","å°é½Š","ç³Šå¼„","ç¹é–‹","å…±é³´","èª¤è§£","å°è³­","å°ç·š","å°æ²–","å°æ¨™","å¾©ç›¤","æ‹†è§£","åæ€","äº¤å·®","äº¤å·",
        "çºŒå‘½","å……é›»","ä¸Šé¦™","èººå¹³","å…§å·","å‡ºåœˆ","å‡ºæˆ²","ç ´é˜²","æ‰˜åº•","ææ°£","é–‹é¦™æª³","æ’é›·","èƒŒé‹","æ‰“é»","æ‰“ç£¨","è£œèª²","å¡é»",
        "æ‰“å¡","æ‘¸é­š","è«‹å‡","è£œçœ ","å®‰åˆ©","è¸©å‘"
      ],
      EMOJI: ["ğŸ¤¡","ğŸ« ","ğŸ¥²","ğŸ¤”","ğŸ˜¶â€ğŸŒ«ï¸","ğŸ«¥","ğŸ˜µâ€ğŸ’«","ğŸ™ƒ","ğŸ˜®â€ğŸ’¨","ğŸ«¨","ğŸ’­","âœ¨","ğŸ’¤","ğŸ”¥","ğŸŒªï¸","ğŸŒ«ï¸","ğŸŒŠ","ğŸ§Š","ğŸ¥¶","ğŸ˜¶","ğŸ¤«","ğŸ«¡","ğŸ¤·","ğŸ§ ","ğŸ“ˆ","ğŸ“‰","ğŸ²","ğŸ§©","ğŸ»","ğŸ¯","â˜•","ğŸ“…","ğŸšŒ","ğŸ›Œ"]
    };

    // =============== èªæ–™åº«ï¼ˆä¸€èˆ¬/æ–°å¢ä¸»é¡Œï¼‰ ===============
    const CORPUS = {
      "å“²ç†é›æ¹¯": [
        "å¤©é»‘è·¯æ»‘ï¼Œç¤¾æœƒè¤‡é›œã€‚",
        "ä¸æ˜¯èª°é›¢ä¸é–‹èª°ï¼Œæ˜¯èª°æ”¾ä¸ä¸‹èª°ã€‚",
        "èµ°éé’æ˜¥çš„å¤å¤©ï¼Œèª°é‚„è¨˜å¾—æ›¾æ˜¯å“ªå¹´ï¼Ÿ",
        "å¸Œæœ›ä¼¼ç«ï¼Œå¤±æœ›å¦‚ç…™ï¼Œäººç”Ÿå¦‚ä¸ƒè™•é»ç«ï¼Œå…«è™•å†’ç…™ã€‚",
        "æ¼«æ¼«äººç”Ÿè·¯ï¼Œä¸€ç›´åœ¨è¿·è·¯ã€‚",
        "ä¸–ç•Œä¸éª¯é«’ï¼Œä½•ä¾†çš„æ‚²å‚·ï¼Ÿ",
        "æˆ‘å€‘éƒ½æ˜¯é è¦–çœ¼ï¼Œæ¨¡ç³Šäº†é›¢æˆ‘å€‘æœ€è¿‘çš„å¹¸ç¦ã€‚",
        "å¿—åœ¨å±±é ‚çš„äººï¼Œä¸æœƒè²ªå¿µå±±è…°çš„é¢¨æ™¯ã€‚",
        "é‚£å€‹å…è¨±æ®éœçš„å¹´ä»£å«é’æ˜¥ã€‚",
        "åˆ¥æ‹¿é’æ˜¥è³­æ˜å¤©ï¼Œè¼¸äº†å°±æ²’æœ‰æ˜å¤©äº†ã€‚",
        "æ„›æƒ…åƒé¬¼ï¼Œç›¸ä¿¡çš„äººå¤šï¼Œä½†è¦‹åˆ°çš„äººå°‘ã€‚",
        "ä¸€å€‹äººç‚«è€€ä»€éº¼ï¼Œå…§å¿ƒå°±ç¼ºå°‘ä»€éº¼ã€‚",
        "æ¡ä¸ä½çš„æ²™ï¼Œä¹¾è„†æšäº†å®ƒã€‚",
        "é“ç†æˆ‘éƒ½æ‡‚ï¼Œå°±æ˜¯ä¸æƒ³ç…§åšã€‚",
        "åˆ¥å’Œç¾å¯¦çˆ­è¾¯ï¼Œå®ƒæœƒç”¨æ™‚é–“æŠŠä½ èªªæœã€‚",
        "ç•¶ç„¶æœƒçŒ¶è±«ï¼Œå› ç‚ºæ¯æ¢è·¯æˆ‘éƒ½æƒ³æˆäº†æ­»è·¯ã€‚",
        "æœ‰äººé å¤©è³¦ï¼Œæœ‰äººé åŠªåŠ›ï¼Œæˆ‘é {KW}çš„é‹æ°£ã€‚"
      ],
      "ç¤¾æœƒå†·ç¬‘è©±": [
        "å»£å‘Šå°±æ˜¯å‘Šè¨´åˆ¥äººï¼ŒéŒ¢ä¹Ÿå¯ä»¥é€™éº¼èŠ±ã€‚",
        "å’Œäººæ¥è§¸ä¹…äº†å°±è¶Šä¾†è¶Šå–œæ­¡ç‹—ï¼Œç‹—æ°¸é æ˜¯ç‹—ï¼Œäººæœ‰æ™‚ä¸æ˜¯äººã€‚",
        "èŠ±æœ‰ç™¾èˆ¬ç´…ï¼Œäººèˆ‡ç‹—ä¸åŒã€‚",
        "ä¸é¡˜åšå¥´éš¸çš„äººæ°‘ï¼Œé¡˜æ„åšäººæ°‘å¹£çš„å¥´éš¸ã€‚",
        "è¿ªå»³æ»¿åº§ï¼Œæ˜¯å› ç‚ºäººå¿ƒå¯‚å¯ã€‚",
        "åˆå¸¥åˆè»Šï¼Œé‚£æ˜¯è±¡æ£‹ï¼›åˆéŒ¢åˆæˆ¿ï¼Œé‚£æ˜¯éŠ€è¡Œã€‚",
        "åŠ›çš„ä½œç”¨æ˜¯ç›¸äº’çš„ï¼Œé™¤äº†æ„›æƒ…çš„åŠ›é‡ã€‚",
        "åˆ¥äººé è³‡æºï¼Œæˆ‘é æƒ…ç·’åƒ¹å€¼å’Œ{KW}ã€‚",
        "{KW}åƒKPIï¼šçœ‹èµ·ä¾†æœ‰æŒ‡æ¨™ï¼Œå¯¦éš›ä¸Šæ²’æœ‰æŒ‡è·¯ã€‚",
        "æ‡‚çš„äººåœ¨æœƒè­°å¤–ï¼Œæœƒè­°è£¡çš„äººéƒ½åœ¨æ‡‚è£æ‡‚ã€‚"
      ],
      "æƒ…æ„Ÿ": [
        "ä¸æ˜¯èª°é›¢ä¸é–‹èª°ï¼Œæ˜¯èª°æ”¾ä¸ä¸‹èª°ã€‚",
        "å¥³äººé•·å¾—æ¼‚äº®æ˜¯å„ªå‹¢ï¼Œæ´»å¾—æ¼‚äº®æ˜¯æœ¬äº‹ã€‚",
        "ä»¤äººé›£ä»¥è‡ªæ‹”çš„ï¼Œé™¤äº†ç‰™é½’é‚„æœ‰æ„›æƒ…ã€‚",
        "äººç”Ÿåƒæ‰“é›»è©±ï¼Œä¸æ˜¯ä½ å…ˆæ›å°±æ˜¯æˆ‘å…ˆæ›ã€‚",
        "è¦è¼¸å°±è¼¸çµ¦è¿½æ±‚ï¼Œè¦å«å°±å«çµ¦å¹¸ç¦ã€‚",
        "å¸Œæœ›ä½ è¢«æº«æŸ”ä»¥å¾…ï¼Œä¹Ÿå¶çˆ¾è¢«ç¾å¯¦æé†’ã€‚",
        "{KW}åƒå‚™ç”¨é›»æ± ï¼Œç”¨åˆ°çš„æ™‚å€™æ‰æƒ³èµ·é‡è¦ã€‚",
        "å–œæ­¡æ˜¯è—ä¸ä½çš„ï¼Œåƒæ‰‹æ©Ÿéœ‡å‹•ï¼Œéš”è‘—{NOUN}éƒ½èƒ½è½è¦‹ã€‚",
        "åˆ†æ‰‹ä¸æ˜¯è¼¸ï¼Œæ˜¯è®“å½¼æ­¤è´å›è‡ªå°Šçš„è´ã€‚"
      ],
      "è‡ªå˜²": [
        "æˆ‘è¦–é‡‘éŒ¢ç‚ºç³åœŸï¼Œæˆ‘çˆ¸è¦–æˆ‘ç‚ºåŒ–ç³æ± ã€‚",
        "æ··åˆ°ç¾åœ¨æ‹¿å¾—èµ·æ”¾å¾—ä¸‹çš„åªæœ‰ç­·å­äº†ã€‚",
        "æˆ‘é•·å¾—å¾ˆè€çœ‹ï¼Œä½ å¾—è€å¿ƒçœ‹ã€‚",
        "æˆ‘å¯ä»¥æ”¾æ£„é¸æ“‡ï¼Œä½†ä¸èƒ½é¸æ“‡æ”¾æ£„ã€‚",
        "å°æ™‚å€™æˆ‘æŠŠç©å…·ç•¶æœ‹å‹ï¼Œé•·å¤§å¾Œæœ‹å‹æŠŠæˆ‘ç•¶ç©å…·ã€‚",
        "åˆ¥äººæ˜¯å¤©é¸ä¹‹äººï¼Œæˆ‘æ˜¯å¤©é¸ä¹‹è¬ã€‚",
        "{KW}æ²’å•é¡Œï¼Œå•é¡Œæ˜¯æˆ‘ã€‚",
        "åŠªåŠ›ä¸æ˜¯ç‚ºäº†å‡ºé ­ï¼Œæ˜¯ç‚ºäº†ä¸å‡ºç³—ã€‚",
        "æˆ‘ä¸æ˜¯ä¸è¡Œï¼Œæ˜¯ä¸å¤ªè¡Œï¼Œä½†å…ˆè¡Œç¦®å¦‚å„€ã€‚"
      ],
      "è·å ´": [
        "KPIæ˜¯å€‹å¥½æ±è¥¿ï¼Œå¤§å®¶éƒ½æ‡‚ï¼Œèª°éƒ½éä¸äº†ã€‚",
        "æœƒè­°åƒæµ·ï¼šè²æµªå¾ˆå¤§ï¼Œæ¼²æ½®é€€æ½®éƒ½å’Œ{KW}ç„¡é—œã€‚",
        "ä»¥ç‚ºåœ¨å¾©ç›¤ï¼Œå…¶å¯¦åœ¨è¤‡è®€ï¼›ä»¥ç‚ºåœ¨å°é½Šï¼Œå…¶å¯¦åœ¨å°ä»˜ã€‚",
        "é€²åº¦åƒæœˆäº®ï¼Œåˆä¸€åäº”ä¸ä¸€æ¨£ã€‚",
        "æ‡‚çš„ä¸èªªï¼Œèªªçš„ä¸æ‡‚ï¼Œæ‡‚èªªçš„éƒ½ä¸åœ¨æœƒè­°è£¡ã€‚",
        "{KW}æ’æœŸå¾ˆæ»¿ï¼Œè½åœ°å¾ˆç©ºã€‚",
        "èººå¹³æ˜¯æˆ°è¡“ï¼ŒçºŒå‘½æ˜¯ä¸»æ¥­ã€‚",
        "å ±è¡¨æœƒå¯«æ•…äº‹ï¼Œç¸¾æ•ˆå–œæ­¡è½ç«¥è©±ã€‚",
        "éœ€æ±‚ä¸é›£ï¼Œé›£åœ¨éœ€æ±‚æ–¹èªªäººè©±ã€‚"
      ],
      "äººç”Ÿ": [
        "æ¡ä¸ä½çš„æ²™ï¼Œä¹¾è„†æšäº†å®ƒã€‚",
        "åªåšç¬¬ä¸€å€‹æˆ‘ï¼Œä¸åšç¬¬äºŒå€‹èª°ã€‚",
        "å¿—åœ¨å±±é ‚çš„äººï¼Œä¸æœƒè²ªå¿µå±±è…°çš„é¢¨æ™¯ã€‚",
        "{KW}ä¸æ˜¯å…¨éƒ¨ï¼Œå»ç¸½èƒ½æŠŠå±€é¢æ”¹å€‹åå­—ã€‚",
        "æˆ‘å€‘éƒ½åœ¨å°‹æ‰¾è·¯ï¼Œå…¶å¯¦è·¯ä¹Ÿåœ¨è§€å¯Ÿæˆ‘å€‘ã€‚",
        "æœ‰äº›äº‹æƒ…ç„¡é ˆçˆ­è¾¯ï¼Œè¡¨é¢æœå¾ï¼Œå·å·åæŠ—ã€‚",
        "åˆ¥æŠŠçœŸå¿ƒè©±èªªå¤ªæ»¿ï¼ŒæŠŠå¹¹è©±ç•™é»ç©ºã€‚"
      ],
      "å‹æƒ…": [
        "æœ‹å‹å°±æ˜¯ï¼šä¸èªªå»¢è©±çš„æ™‚å€™å¿ƒç…§ä¸å®£ï¼Œèªªèµ·å»¢è©±çš„æ™‚å€™ä¸€æ‹å³åˆã€‚",
        "åœ¨å ´çš„éƒ½æ‡‚æˆ‘æ„æ€ï¼Œä¸åœ¨å ´çš„æ›´æ‡‚æˆ‘çš„å¹¹è©±ã€‚",
        "ä¸€èµ·è£ç˜‹è³£å‚»çš„ï¼Œæ‰é…å«{KW}é‚£æ‰¹äººã€‚",
        "å’Œä½ èªªå¤§é“ç†æ˜¯ç¦®è²Œï¼Œå’Œä½ èªªå¹¹è©±æ‰æ˜¯è¦ªå¯†ã€‚",
        "ä¹¾äº†é€™æ¯ç™½é–‹æ°´ï¼Œç‚ºä»Šå¤©ä¸æƒ³åŠªåŠ›çš„æˆ‘å€‘ã€‚"
      ],
      "æŠ¼éŸ»å°ä»—": [
        "å¤©é«˜ä»»æˆ‘é£›ï¼Œåœ°åšæ¥æˆ‘å¢œã€‚",
        "å–æ°´ä¸å¿˜æŒ–äº•äººï¼ŒåƒåœŸä¸å¿˜æˆ¿è²¸äººã€‚",
        "ä¸Šè¯ï¼š{KW}ä¸å‹•å¦‚å±±ï¼›ä¸‹è¯ï¼šå˜´ä¸Šé¢¨ç”Ÿæ°´èµ·ã€‚",
        "ä¸Šè¯ï¼šé¸æ“‡å›°é›£ç—‡ï¼›ä¸‹è¯ï¼šç—‡ç‹€é¸æ“‡å›°é›£ã€‚",
        "ä¸Šè¯ï¼šé“ç†éƒ½æ‡‚æ²’ç”¨ï¼›ä¸‹è¯ï¼šæƒ…ç·’åˆ°ä½å°±è¡Œã€‚",
        "ä¸Šè¯ï¼šç†æƒ³è£å£è¢‹ï¼›ä¸‹è¯ï¼šç¾å¯¦å¡æ»¿æ ¼ã€‚"
      ],
      "ç§‘æŠ€å®…": [
        "{KW}åƒç·©å­˜ï¼Œæ¸…äº†ä»¥å¾Œæ‰ç™¼ç¾è‡ªå·±æ‰æ˜¯ç“¶é ¸ã€‚",
        "æˆ‘ä¸æ˜¯æ‹–å»¶ï¼Œæˆ‘åœ¨ç­‰å¾…æœ€ä½³ç·¨è­¯æ™‚é–“ã€‚",
        "å•é¡Œä¸åœ¨bugï¼Œåœ¨æ–¼æˆ‘æŠŠç”Ÿæ´»ç•¶debugã€‚",
        "äººç”Ÿä¸æ˜¯äºŒé€²ä½ï¼Œå»ç¸½åœ¨0å’Œ1ä¹‹é–“å¡ä½ã€‚",
        "æˆ‘ä¸æ˜¯å®…ï¼Œæˆ‘æ˜¯ä½å»¶é²ç”Ÿæ´»å¯¦è¸è€…ã€‚",
        "ä»Šå¤©çš„éˆæ„Ÿäº¤çµ¦æ˜å¤©çš„æˆ‘åˆä½µè¡çªã€‚",
        "äººéš›é—œä¿‚åƒå¾®æœå‹™ï¼Œæ•…éšœæ™‚éƒ½æ€ªç¶²è·¯ã€‚",
        "åˆ¥å•æˆ‘æ„›ä¸æ„›ä½ ï¼Œå…ˆå•ç³»çµ±çµ¦ä¸çµ¦æ¬Šé™ã€‚"
      ],
      "é›»ç«¶éŠæˆ²": [
        "åˆå¸¥åˆè»Šé‚£æ˜¯è±¡æ£‹ï¼Œæˆ‘æ˜¯åˆèœåˆæ„›ç©é‚£ç¨®ã€‚",
        "è¼¸è´ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯è¼¸å¾—æœ‰ç•«é¢ã€‚",
        "{KW}åƒCDï¼Œæ€¥ä¹Ÿæ€¥ä¸ä¾†ã€‚",
        "æ’ä½åƒäººç”Ÿï¼šé€£è·ªæ™‚ï¼Œå…¨æ€ªéšŠå‹ï¼›é€£å‹æ™‚ï¼Œéƒ½æ˜¯å¯¦åŠ›ã€‚",
        "åˆ¥ç ”ç©¶ç‰ˆæœ¬ç­”æ¡ˆäº†ï¼Œç ”ç©¶æ€éº¼æ´»ä¸‹ä¾†æ¯”è¼ƒé è­œã€‚",
        "æ“ä½œæ‹‰æ»¿ï¼Œè…¦å­å¾…æ©Ÿã€‚",
        "å‘æ˜¯å¤§å®¶çš„ï¼Œé‹æ˜¯æˆ‘çš„ã€‚"
      ],
      "å¥èº«": [
        "åˆ¥äººæµæ±—æ˜¯ç™¼å…‰ï¼Œæˆ‘æµæ±—æ˜¯çºŒå‘½ã€‚",
        "è‡ªå¾‹ä¸æ˜¯æŠŠç”œé»æˆ’æ‰ï¼Œæ˜¯æŠŠ{KW}æ›æˆé›¶å¡ã€‚",
        "ä»Šå¤©ä¸ç·´ï¼Œæ˜å¤©å¾’å‚·æ‚²ã€‚",
        "ä¸‰åˆ†ç·´ä¸ƒåˆ†åƒï¼Œé‚„æœ‰ä¹ååˆ†æƒ³å¤ªå¤šã€‚",
        "è‚Œè‚‰æ˜¯å­˜æ¬¾ï¼Œè„‚è‚ªæ˜¯é€šè†¨ã€‚",
        "æ¡ä½å•éˆ´åƒæ¡ä½äººç”Ÿï¼šæ²‰é‡ä½†å®‰å¿ƒã€‚",
        "è…¹è‚Œåœ¨è·¯ä¸Šï¼Œå¤–è³£ä¹Ÿåœ¨è·¯ä¸Šã€‚"
      ],
      "ç†è²¡": [
        "ç†è²¡çš„ç¬¬ä¸€æ­¥æ˜¯èªæ¸…ï¼š{KW}ä¸æ˜¯è³‡ç”¢ï¼Œæ˜¯æƒ…ç·’ã€‚",
        "çœçš„æ˜¯é›æ¯›ï¼ŒèŠ±çš„æ˜¯é·¹æšã€‚",
        "æŠ•è³‡è¬›ç´€å¾‹ï¼ŒåƒåœŸè¬›æ°£è³ªã€‚",
        "åŸºé‡‘æ˜¯å®šæŠ•ï¼Œäººç”Ÿæ˜¯å®šç—›ã€‚",
        "æˆ‘ä¸æ˜¯æŠ„åº•ï¼Œæˆ‘æ˜¯æŠ„ä½œæ¥­ã€‚",
        "æ¼²äº†æ˜¯çœ¼å…‰ï¼Œè·Œäº†æ˜¯çœ¼æ·šã€‚"
      ],
      "æ—…è¡Œ": [
        "èªªèµ°å°±èµ°çš„æ˜¯æ—…è¡Œï¼Œèªªç¡å°±ç¡çš„æ˜¯æˆ‘ã€‚",
        "é¢¨æ™¯ä¸æœƒèªªè©±ï¼Œä½†å¾ˆæœƒå®‰æ…°äººã€‚",
        "è¿·è·¯æ˜¯æ—…è¡Œçš„ä¸»ç·šä»»å‹™ã€‚",
        "{KW}åƒè¡Œæï¼šå¸¶ä¸Šäº†ï¼Œæ‰çŸ¥é“æ²‰ä¸æ²‰ã€‚",
        "æ”»ç•¥åšå¾—å†å¥½ï¼Œä¹Ÿæ“‹ä¸ä½é‡è¦‹çš„å·§åˆã€‚",
        "å‡ºç™¼ä¹‹å‰ï¼Œå…ˆæŠŠå¿ƒæƒ…check-inã€‚"
      ],
      "ç¾é£Ÿ": [
        "äººç”Ÿå·²ç¶“å¾ˆè‹¦äº†ï¼Œ{KW}è«‹åŠ å€ç”œã€‚",
        "åƒä¸é£½å“ªæœ‰åŠ›æ°£åšå¤¢ï¼Ÿ",
        "ç†±é‡æ˜¯æš«æ™‚çš„ï¼Œå¿«æ¨‚æ˜¯æ°¸ä¹…çš„ã€‚",
        "æ²’æœ‰è¢«é£Ÿç‰©æ²»ç™’çš„å¤œæ™šï¼Œåªé…è¢«å¤–è³£æ²»ç™’ã€‚",
        "å¡è·¯é‡Œæ˜¯å¹¹è©±çš„ç‡ƒæ–™ã€‚"
      ],
      "æ ¡åœ’ç•¢æ¥­": [
        "èµ°éé’æ˜¥çš„å¤å¤©ï¼Œèª°é‚„è¨˜å¾—æ›¾æ˜¯å“ªå¹´ï¼Ÿ",
        "{KW}åƒç•¢æ¥­ç…§ï¼šæ‹å¾—å¾ˆç¬‘ï¼Œæ”¾å¾—å¾ˆä¹…ã€‚",
        "ä¸Šèª²åƒé•·è·‘ï¼Œä¸‹èª²åƒè‡ªç”±è½é«”ã€‚",
        "ä½œæ¥­å’Œæ„›æƒ…ä¸€æ¨£ï¼šæ‹–åˆ°æœ€å¾Œæ‰æœ‰éˆæ„Ÿã€‚",
        "é’æ˜¥æ˜¯å…è¨±æ®éœçš„å¹´ä»£ï¼Œæ®éœå®Œäº†å«å±¥æ­·ã€‚",
        "é›¢é–‹æ ¡åœ’æ‰æ‡‚ï¼Œéˆ´è²æ˜¯æœ€å¥½çš„OKRã€‚"
      ],
      "è¿·å› å­¸": [
        "è­‰æ˜è‡ªå·±ä¸é äº‹å¯¦ï¼Œé æµé‡ã€‚",
        "å¤§å®¶éƒ½åœ¨ç·šä¸Šï¼Œåªæœ‰æˆ‘åœ¨ç·šä¸‹çš„ä¸‹ã€‚",
        "æŠŠé“ç†åšæˆè²¼ç´™ï¼Œè²¼åˆ°{KW}ä¸Šå®ƒå°±æœ‰ç”¨äº†ã€‚",
        "å…ˆç•«é¤…å†ä¸Šèœï¼Œå‘³é“è‡ªç„¶ä¸é‡è¦ã€‚",
        "æƒ…ç·’åˆ°ä½ï¼Œé‚è¼¯å°±åœ°æ…°å•ã€‚",
        "æˆ‘åœ¨è¼¸å‡ºåƒ¹å€¼çš„è·¯ä¸Šï¼Œçµæœè¼¸å‡ºäº†è¡¨æƒ…åŒ…ã€‚"
      ],
      "æ¯’é›æ¹¯": [
        "ç´¯å—ï¼Ÿç´¯å°±å°äº†ï¼Œèˆ’æœæ˜¯ç•™çµ¦æ­»äººçš„ã€‚",
        "åªè¦ç›£ç„ä¸é»ƒï¼Œæˆ‘å°±ç¹¼çºŒçŒ–ç‹‚ã€‚",
        "æˆ‘å‘½ç”±æˆ‘ä¸ç”±å¤©ï¼Œå¤©è¦æ»…æˆ‘æˆ‘æ»…å¤©ã€‚",
        "ä½ èªªçš„ä¸æ˜¯å»ºè­°ï¼Œæ˜¯å›éŸ³ï¼›æˆ‘å›çš„æ˜¯ç¦®è²Œï¼Œä¸æ˜¯ç­”æ¡ˆã€‚",
        "ç•¶é¢æº«æŸ”ï¼ŒèƒŒåœ°è£¡å„è‡ªæ¸…é†’ã€‚",
        "æˆå¹´äººçš„å¿«æ¨‚åƒæ—©å…«çš„é¬§é˜ï¼ŒéŸ¿äº†é‚„æ˜¯è£æ²’è½è¦‹ã€‚",
        "å…§è€—æ˜¯å…è²»çºŒå‘½åŒ…ï¼Œåƒäº†æ›´ç´¯é‚„åœä¸ä¸‹ä¾†ã€‚",
        "ä¸Šç­åƒå¥èº«ï¼Œç·´çš„æ˜¯æŠ—æ‰“æ“Šèƒ½åŠ›ã€‚"
      ],
      "ç¤¾ç¾¤åª’é«”": [
        "åˆ¥æŠŠç”Ÿæ´»éå¾—åƒé™æ™‚å‹•æ…‹ï¼Œ24å°æ™‚å°±éæœŸã€‚",
        "æ¼”ç®—æ³•å–œæ­¡æˆ‘ç„¦æ…®çš„æ¨£å­ï¼Œå› ç‚ºæœƒå¤šæ»‘å¹¾é ã€‚",
        "ç™¼æ–‡ä¸æ˜¯è¼¸å‡ºåƒ¹å€¼ï¼Œæ˜¯è¼¸å‡ºå­˜åœ¨æ„Ÿã€‚",
        "{KW}é…æ¿¾é¡éƒ½æ¼‚äº®ï¼Œä¸é…é‚è¼¯ä¹Ÿèƒ½ç«ã€‚"
      ],
      "å…§è€—": [
        "æˆ‘ç™½å¤©å’Œä¸–ç•Œå°ç·šï¼Œæ™šä¸Šå’Œè‡ªå·±å°å³™ã€‚",
        "æœ€æœƒæ‹–ç´¯æˆ‘çš„äººï¼Œæ˜¯æˆ‘ã€‚",
        "{KW}ä¸æ˜¯é›£é¡Œï¼Œè…¦å…§å°åŠ‡å ´æ‰æ˜¯ã€‚",
        "æŠŠé¸æ“‡åšæˆé¸ç§€ï¼Œæœ€å¾ŒæŠ•ç¥¨çš„æ˜¯ç„¦æ…®ã€‚"
      ],
      "é€šå‹¤": [
        "è»Šåœ¨å‹•ï¼Œæˆ‘åœ¨ä¸å‹•ï¼Œé€²åº¦åœ¨åŸåœ°è¸æ­¥ã€‚",
        "é€šå‹¤åƒé•·è·‘ï¼Œçµ‚é»åªæœ‰æ‰“å¡æ©Ÿã€‚",
        "åœ°éµæ’­å ±æ˜¯æé†’ï¼Œæˆ‘é‚„åœ¨éæ˜¨å¤©ã€‚",
        "{KW}å¡åœ¨è·¯ä¸Šï¼Œæˆ‘å¡åœ¨æƒ…ç·’è£¡ã€‚"
      ],
      "ä¸Šç­æ‘¸é­š": [
        "å·¥ä½œé‡åƒæ½®æ±ï¼Œæ‘¸é­šæ˜¯æ²»æ°´å·¥ç¨‹ã€‚",
        "æˆ‘ä¸æ˜¯ä¸åŠªåŠ›ï¼Œæˆ‘åœ¨ç­‰å¾…åˆé©çš„æ‘¸é­šæª”æœŸã€‚",
        "æ‘¸é­šä¸æ˜¯å·æ‡¶ï¼Œæ˜¯çµ¦éˆæ„ŸçºŒå‘½ã€‚",
        "{KW}å…ˆæ“±è‘—ï¼Œå…ˆæŠŠç‹€æ…‹é¤Šå¥½ã€‚"
      ],
      "é¢è©¦": [
        "æˆ‘æ“…é•·çš„æŠ€èƒ½æœ‰ï¼šæŠŠå»¢è©±èªªæˆäººè©±ï¼ŒæŠŠäººè©±èªªæˆå¹¹è©±ã€‚",
        "è‡ªæˆ‘ä»‹ç´¹åƒæ˜¯PPTï¼Œæˆ‘æ˜¯é‚£å¼µéæ¸¡é ã€‚",
        "å„ªé»æ˜¯æœƒå¾©ç›¤ï¼Œç¼ºé»æ˜¯æœƒéåº¦å¾©ç›¤ã€‚",
        "{KW}ç¶“é©—è±å¯Œï¼Œä¸»è¦è±å¯Œåœ¨æƒ³åƒåŠ›ã€‚"
      ],
      "å‰µæ¥­": [
        "å‰µæ¥­æ˜¯æŠŠä¸ç¢ºå®šæ€§é¤Šæˆå¯µç‰©ï¼Œå¤©å¤©å–‚å®ƒéŒ¢ã€‚",
        "èè³‡åƒç´„æœƒï¼Œå½¼æ­¤éƒ½æ€•å½¼æ­¤æœ‰æ›´å¥½é¸æ“‡ã€‚",
        "ç¾é‡‘æµæ˜¯KPIçš„åª½åª½ã€‚",
        "{KW}ä¸æ˜¯å•†æ¥­æ¨¡å¼ï¼Œæ˜¯ç”Ÿå­˜æ¨¡å¼ã€‚"
      ],
      "ç†¬å¤œæ—©å…«": [
        "æ—©å…«æ˜¯é¬§é˜ï¼Œç†¬å¤œæ˜¯ä¿¡ä»°ã€‚",
        "æˆ‘æŠŠç¡çœ äº¤çµ¦æœªä¾†çš„æˆ‘è™•ç†ã€‚",
        "å‡Œæ™¨çš„éˆæ„Ÿå€¼éŒ¢ï¼Œç™½å¤©çš„ç‹€æ…‹è¦å‘½ã€‚",
        "{KW}æ˜å¤©å†èªªï¼Œä»Šå¤©å…ˆä¸èªªã€‚"
      ],
      "é¤Šç”Ÿ": [
        "ä¿æº«æ¯è£¡æ³¡æ¸æï¼Œå˜´ä¸Šèªªè‘—éš¨ç·£ã€‚",
        "ç¶­ä»–å‘½è£œçš„æ˜¯å¿ƒå®‰ã€‚",
        "{KW}å°‘ä¸€é»ï¼Œæ—©ç¡å¤šä¸€é»ï¼Œç„¦æ…®å°‘ä¸€é»ã€‚",
        "é‹å‹•ä¸æ˜¯æ¸›å£“ï¼Œæ˜¯åœ¨å£“åŠ›è£¡æ‰¾æ°§æ°£ã€‚"
      ],
      "å’–å•¡": [
        "ç¬¬ä¸€æ¯æ˜¯é†’ä¾†ç”¨çš„ï¼Œç¬¬äºŒæ¯æ˜¯æ´»è‘—ç”¨çš„ã€‚",
        "åŠ å¥¶ä¸åŠ ç³–ï¼Œå› ç‚ºç”Ÿæ´»å·²ç¶“å¤ ç”œäº†æ²’æœ‰ã€‚",
        "{KW}åƒå’–å•¡å› ï¼Œå…ˆè®“äººä¸Šé ­ï¼Œå†è®“äººå¿ƒæ‚¸ã€‚",
        "ä»Šå¤©çš„æˆ‘ç”±ç¾å¼é©…å‹•ã€‚"
      ],
      "æ›¸å½±éŸ³": [
        "æˆ‘çœ‹äº†å¾ˆå¤šæ›¸ï¼Œä¸»è¦æ˜¯æ›¸åã€‚",
        "å½±è©•åƒäººç”Ÿå»ºè­°ï¼šçœ‹æ‡‚äº†ä¸ä¸€å®šç…§åšã€‚",
        "æ­Œå–®åœ¨å¾ªç’°ï¼Œç”Ÿæ´»åœ¨åŸåœ°ã€‚",
        "{KW}åƒç‰‡å°¾å½©è›‹ï¼Œç­‰åˆ°äº†ä¹Ÿå°±é‚£æ¨£ã€‚"
      ],
      "å°ˆæ¡ˆç®¡ç†": [
        "æ’ç¨‹åƒå¤šç±³è«¾ï¼Œå€’çš„æ°¸é æ¯”ç«‹èµ·ä¾†çš„å¿«ã€‚",
        "é¢¨éšªç™»éŒ„è¡¨å¾ˆé•·ï¼Œç¡çœ æ™‚é•·å¾ˆçŸ­ã€‚",
        "äº¤ä»˜æ˜¯çµ‚é»ï¼Œä¹Ÿæ˜¯ä¸‹ä¸€å€‹å‘çš„èµ·é»ã€‚",
        "{KW}ä¸æ˜¯é˜»å¡ï¼Œæ˜¯å¤§å®¶å…±åŒçš„è—‰å£ã€‚"
      ]
    };

    // =============== æˆäººèªæ–™åº«ï¼ˆé›™é—œ / éœ²éª¨ 18+ï¼‰ ===============
    // åƒ…é™æˆå¹´ã€è‡ªé¡˜æƒ…å¢ƒï¼›ç”Ÿæˆæ™‚å°‡é€²è¡Œå®‰å…¨æª¢æŸ¥ï¼ˆæ’é™¤æœªæˆå¹´ã€äº‚å€«ã€éè‡ªé¡˜ã€ç¸äº¤ç­‰ï¼‰
    const CORPUS_ADULT = {
      "æˆäºº-é›™é—œ": [
        "ä»Šæ™šçš„æµç¨‹å¯«å¥½äº†ï¼šå‰æˆ²æš–å ´ï¼Œæ­£é¡Œå…©å›ï¼ŒåŠ æ˜ æŠ±è‘—ç¡ã€‚",
        "æŠŠç†æ™ºæ”¾é€²æŠ½å±œï¼ŒæŠŠä½ æ”¾åœ¨æˆ‘å¿ƒä¸Šï¼Œé †ä¾¿æ”¾åœ¨æˆ‘èº«ä¸Šã€‚",
        "æƒ³è·Ÿä½ åšé“é¡Œï¼šå…ˆå£ç®—ï¼Œå†ç­†ç®—ï¼Œæœ€å¾Œå¿ƒç®—åˆ°å¤©äº®ã€‚",
        "ç‡ˆå…ˆé—œä¸€ç›ï¼Œè†½å­å°±æ•¢ä¸€å¯¸ã€‚",
        "{KW}ç•¶å®‰å…¨è©ï¼Œèªªåˆ°å®ƒå°±æš«åœï¼Œæ²’èªªå°±åˆ¥åœã€‚",
        "æˆ¿é–€åƒBugï¼Œä¸€é—œå°±ä¸æƒ³ä¿®ï¼›åªæƒ³è®“ä½ ä¿®æˆ‘ã€‚",
        "ä»Šæ™šçš„KPIï¼šä½ æ»¿æ„ã€æˆ‘æ»¿èº«ã€åºŠæ»¿åˆ†ã€‚",
        "æƒ³å’Œä½ é–‹å€‹æœƒï¼Œè­°ç¨‹åªæœ‰ä¸€é …ï¼šå½¼æ­¤åŒæ„ï¼Œç›´åˆ°å½¼æ­¤åŒæ„ã€‚",
        "åˆ¥èŠå®‡å®™çš„ç›¡é ­äº†ï¼ŒèŠèŠæˆ‘å€‘çš„ç›¡é ­ç¢°åˆ°ç›¡é ­ã€‚",
        "æŠŠå°ˆæ¡ˆæ‹†æˆä»»å‹™ï¼ŒæŠŠä½ æ‹†æˆè¦ªä¸€å£ã€æŠ±ä¸€ä¸‹ã€åˆ°æœ€å¾Œã€‚"
      ],
      "æˆäºº-éœ²éª¨": [
        "æˆ‘æƒ³ç”¨èˆŒé ­æŠŠä½ ä»Šå¤©çš„ä¸å¿«ä¸€é»é»èˆ”æ‰ï¼Œç›´åˆ°ä½ åªå‰©é¡«æŠ–å’Œç¬‘ã€‚",
        "å£ç´…åˆ¥æ“¦ï¼Œæˆ‘æƒ³æ²¿è‘—é¡è‰²ä¸€è·¯è¦ªä¸‹å»ï¼Œåœåœ¨ä½ è®“æˆ‘åœçš„åœ°æ–¹ã€‚",
        "æŠŠ{KW}ç•¶å®‰å…¨è©ï¼Œä½ èªªå‡ºå£å°±æ›æ…¢é€Ÿï¼›æ²’èªªï¼Œå°±åˆ¥è®“æˆ‘åœã€‚",
        "æƒ³çœ‹ä½ è·¨ååœ¨æˆ‘èº«ä¸Šï¼ŒæŠ“è‘—æˆ‘ä¸æ”¾ï¼Œåƒé¨è‘—äººç”Ÿç¬¬ä¸€æ¬¡å°çš„æ–¹å‘éµã€‚",
        "ä»Šæ™šä¸è¦å®¢å¥—ï¼Œæƒ³æŠŠä½ å¾ç‰†é‚Šå»åˆ°åºŠé‚Šï¼Œå†å¾åºŠé‚Šå»å›ç‰†é‚Šã€‚",
        "ä½ çš„å–˜æ¯åƒç¯€æ‹å™¨ï¼Œæˆ‘ç”¨èº«é«”å°é½Šç¯€å¥ï¼Œç›´åˆ°æˆ‘å€‘åŒæ™‚å¤±æ§ã€‚",
        "æŠŠé›™æ‰‹å€Ÿçµ¦æˆ‘ï¼Œå…¶ä»–äº¤çµ¦æˆ‘ï¼›ç­‰æœƒå…’æŠŠè²éŸ³å€Ÿçµ¦é„°å±…ã€‚",
        "æˆ‘å–œæ­¡ä½ èªªè‡Ÿè©±çš„æ¨£å­ï¼Œå°±åƒç™½å™ªéŸ³è“‹ä½å…¨ä¸–ç•Œï¼Œåªå‰©æˆ‘å€‘çš„è²éŸ³ã€‚",
        "æŠŠç†æ™ºç•™åˆ°æ˜å¤©ï¼Œä»Šæ™šåªæƒ³æŠŠä½ å¡«æ»¿åˆ°æ²’ç©ºæƒ³åˆ¥çš„ã€‚",
        "ä¸å¿…å‡è£çŸœæŒï¼ŒæŠŠä½ çš„æ¿•ç†±äº¤çµ¦æˆ‘ï¼Œæˆ‘æœƒæŠŠæˆ‘çš„å…¨éƒ¨éƒ½äº¤å›å»ã€‚",
        "æˆ‘è¦æ…¢æ…¢é€²ï¼Œè®“ä½ æ¸…æ¥šè¨˜å¾—æ¯ä¸€å¯¸ï¼›ä¹Ÿè¦å¿«å¿«é€€ï¼Œè®“ä½ æ›´æ¨ä¸å¾—æˆ‘ã€‚",
        "æˆ‘æƒ³æŠŠä½ æŠ±åˆ°å¤±é‡ï¼Œè¦ªåˆ°å¤±èªï¼Œåšæ„›åšåˆ°å¤±çœ ã€‚",
        "ä¸è¦å•æˆ‘æ„›ä¸æ„›ä½ ï¼Œå…ˆè®“æˆ‘é€²å»ï¼Œè®“ç­”æ¡ˆè‡ªå·±æ¿•å‡ºä¾†ã€‚"
      ]
    };

    // =============== æ¨¡æ¿ç¢ç‰‡ ===============
    const FRAG = {
      OPEN: ["è¬›çœŸï¼Œ","åš´è‚…ä¸€é»ï¼Œ","ä¸é–‹ç©ç¬‘ï¼Œ","æˆ‘æœ‰å€‹ä¸æˆç†Ÿçš„å°å»ºè­°ï¼š","æ“šè·¯é‚Šç¤¾çµ±è¨ˆï¼Œ","å¯«åœ¨å‰é¢ï¼š","é“ç†å…ˆæ”¾ä¸€é‚Šï¼Œ","æˆ‘å…ˆèƒ¡èªªå…©å¥ï¼š","åˆ¥æ€¥è‘—åé§ï¼Œ"],
      CLAIM: [
        "é“ç†éƒ½æ‡‚ï¼Œåšèµ·ä¾†å…¨å¿˜","è¨ˆç•«è¶•ä¸ä¸Šè®ŠåŒ–","æ¸…é†’çš„äººæœ€é›£å¿«æ¨‚","é«”é¢æœ‰æ™‚æ¯”æ­£ç¢ºé‡è¦","å¤§å®¶éƒ½å¾ˆå¿™ï¼Œå¿™è‘—é¡¯å¾—ä¸å¿™",
        "èªªç©¿äº†ä¹Ÿå°±é‚£éº¼å›äº‹","æ•…äº‹éœ€è¦è½‰å ´ï¼Œäººç”Ÿéœ€è¦è½‰èº«","å¤§é“ç†è£å£è¢‹ï¼Œå°æƒ…ç·’æ”¾è‡‰ä¸Š","è¼¸å‡ºå¹¹è©±æ¯”è¼¸å‡ºåƒ¹å€¼ç°¡å–®å¤šäº†"
      ],
      TURN: ["èªªç™½äº†å°±æ˜¯","èªªå¥½è½æ˜¯","åˆ¥ç¹å½äº†ï¼Œå…¶å¯¦æ˜¯","è©±åˆ¥èªªæ»¿ï¼Œæ­¸æ ¹åˆ°åº•æ˜¯","æ ¸å¿ƒå•é¡Œæ°¸é æ˜¯","ç¸½ä¹‹","ä½†è©±èªªå›ä¾†ï¼Œ"],
      PUNCH: [
        "æ±‚çš„æ˜¯é«”é¢ï¼Œä¸æ˜¯é«”ç¾","æƒ…ç·’å…ˆåˆ°ä½ï¼Œé‚è¼¯æ…¢æ…¢è£œ","æˆ‘å€‘éœ€è¦çš„æ˜¯æŒè²ï¼Œä¸æ˜¯æŒæ§","å…ˆæŠŠæª”åšæ¼‚äº®ï¼Œå†æŠŠäº‹åšæ˜ç™½",
        "æŠŠè¤‡é›œçš„ç•™çµ¦æ˜å¤©ï¼ŒæŠŠå¥½è½çš„ç•™çµ¦ä»Šå¤©","æœ‰æ²’æœ‰ç”¨å†èªªï¼Œå…ˆå¥½ç¬‘å†ç®—","æ²’è§£æ±ºå•é¡Œï¼Œå…ˆè§£æ±ºç•«é¢",
        "é {KW}æ’å ´é¢ï¼Œé æ²‰é»˜æ’æ°£è³ª","æŠŠ{NOUN}èªªæˆæ•…äº‹ï¼ŒæŠŠ{KW}èªªæˆå‚³èªª"
      ],
      TAIL: ["ã€‚","ã€‚{EMOJI}","ã€‚â€”â€”æ‡‚çš„è‡ªç„¶æ‡‚","ã€‚ä¸æ‡‚ä¹Ÿæ­£å¸¸","ã€‚æ­¡è¿åé§ï¼Œåé§ç„¡æ•ˆ"]
    };

    const TEMPLATES = [
      "{OPEN}{CLAIM}ï¼Œ{TURN}{PUNCH}{TAIL}",
      "{OPEN}{KW}é€™ä»¶å°äº‹ï¼Œ{CLAIM}ï¼›å¤§æ¦‚æ‡‚äº†ä»€éº¼å«{NOUN}ã€‚",
      "{OPEN}{THEME}ä¸è¤‡é›œï¼Œè¤‡é›œçš„æ˜¯æˆ‘å€‘æƒ³æŠŠå®ƒèªªå¾—è¤‡é›œã€‚",
      "{OPEN}è½éå¾ˆå¤šé“ç†ï¼Œæ±ºå®šå…ˆæŠŠ{KW}æ”¾ä¸€é‚Šï¼Œ{PUNCH}",
      "{OPEN}æ‰€è¬‚æˆç†Ÿï¼Œå°±æ˜¯å­¸æœƒåœ¨{NOUN}è£¡é¢å‡è£æ¸…é†’ã€‚",
      "{OPEN}æœ‰äººé å¤©è³¦ï¼Œæœ‰äººé åŠªåŠ›ï¼Œæˆ‘é {KW}å’Œé‹æ°£ç«™èµ·ä¾†çš„éŒ¯è¦ºã€‚",
      "{OPEN}åˆ¥æŠŠçœŸå¿ƒè©±èªªå¤ªæ»¿ï¼ŒæŠŠå¹¹è©±ç•™é»ç©ºï¼Œ{PUNCH}",
      "{KW}ä¸æ˜¯è§£æ³•ï¼Œæ˜¯å€‹æé†’ï¼š{CLAIM}ï¼Œ{PUNCH}",
      "{KW}åƒ{NOUN}ï¼Œçœ‹èµ·ä¾†æœ‰ä»½é‡ï¼Œè½åœ°åªå‰©å½¢ç‹€ã€‚",
      "{KW}åœ¨å·¦ï¼Œ{NOUN}åœ¨å³ï¼›å‰è·¯ä¸æ˜ï¼Œæƒ…ç·’å…ˆåˆ°ã€‚",
      "{THEME}æœ‰æµç¨‹ï¼Œ{KW}æ²’åŠ‡æœ¬ï¼›äººè¨­è¦é«”é¢ï¼Œå¿ƒäº‹è¦é«”è«’ã€‚",
      "åˆ¥å’Œ{NOUN}çˆ­è¾¯ï¼Œå®ƒæœƒç”¨æ™‚é–“æŠŠä½ èªªæœã€‚",
      "ç•¶{NOUN}é–‹å§‹è§£é‡‹ï¼Œä¸€åˆ‡å°±è®Šå¾—æ›´{ADJ}ã€‚",
      "æŠŠè©±èªªæ»¿çš„äººï¼Œå¸¸æŠŠäº‹åšç©ºï¼›æŠŠ{KW}èªªè¼•çš„äººï¼Œæ‰çŸ¥é“å®ƒæœ‰å¤šé‡ã€‚",
      "ä½ ä»¥ç‚ºæˆ‘åœ¨è¼¸å‡ºåƒ¹å€¼ï¼Œå…¶å¯¦æˆ‘åœ¨è¼¸å‡ºæƒ…ç·’ï¼›ä½ ä»¥ç‚º{KW}åœ¨å¹«å¿™ï¼Œå…¶å¯¦åœ¨æ·»å µã€‚"
    ];

    // æˆäººæ¨¡æ¿ï¼ˆé›™é—œ/éœ²éª¨ï¼‰
    const TEMPLATES_ADULT = {
      hint: [
        "ä»Šæ™šæŠŠ{KW}ç•¶å®‰å…¨è©ï¼Œå…ˆæš–å ´ï¼Œå†æ­£é¡Œï¼Œæœ€å¾ŒæŠ±ç·Šè™•ç†ã€‚",
        "è«‹æŠŠç†æ™ºæ”¾æŠ½å±œï¼ŒæŠŠæˆ‘æ”¾é€²ä½ å¿ƒè£¡ï¼Œé †ä¾¿æ”¾åœ¨ä½ èº«ä¸Šã€‚",
        "æˆ‘å€‘ä¾†å°é½Šç¯€å¥ï¼šå‰å¥æ…¢ä¸€é»ï¼Œå‰¯æ­Œé‡ä¸€é»ï¼Œ{KW}å–Šäº†å°±åœä¸€é»ã€‚"
      ],
      explicit: [
        "æˆ‘æƒ³ç”¨èˆŒé ­æ²¿è‘—ä½ æœ€æ•æ„Ÿçš„åœ°æ–¹æ…¢æ…¢ç•«åœ“ï¼Œç›´åˆ°ä½ è¨˜ä¸ä½{KW}ã€‚",
        "ä½ è·¨ååœ¨æˆ‘èº«ä¸Šï¼Œæˆ‘æŠ“ä½ä½ çš„è…°ï¼Œç¯€å¥ä¸€å¿«æˆ‘å€‘å°±åŒæ™‚å¤±æ§ã€‚",
        "ä»Šæ™šåˆ¥è®“æˆ‘å®¢æ°£ï¼ŒæŠŠä½ å¡«æ»¿åˆ°å†ä¹Ÿé¨™ä¸äº†èº«é«”ã€‚"
      ]
    };

    // =============== å®‰å…¨éæ¿¾ï¼ˆç´”æ·¨ + æˆäººå®‰å…¨ï¼‰ ===============
    // å–æ¶ˆç´”æ·¨æ¨¡å¼ï¼šä¸å†éæ¿¾è©å½™
    function filterDirty(text){ return text; }
    // æˆäººå®‰å…¨ï¼šæ’é™¤æœªæˆå¹´/äº‚å€«/éè‡ªé¡˜/ç¸äº¤ç­‰å­—çœ¼
    const BLOCK_MINOR = ["æœªæˆå¹´","æœªæ»¿18","æœªæ»¿åå…«","å°å­©","å…’ç«¥","å¬°å…’","åœ‹ä¸­ç”Ÿ","é«˜ä¸­ç”Ÿ","å°å­¸ç”Ÿ","å¥³ç«¥","ç”·ç«¥","ç«¥é¡","è˜¿è‰","æ­£å¤ª"];
    const BLOCK_INCEST = ["çˆ¸","çˆ¶","æ¯","åª½","å…¬å…¬","å©†å©†","å²³çˆ¶","å²³æ¯","ç¹¼çˆ¶","ç¹¼æ¯","å“¥å“¥","å¼Ÿå¼Ÿ","å§å§","å¦¹å¦¹","è¡¨å“¥","è¡¨å¼Ÿ","è¡¨å§","è¡¨å¦¹","å ‚å“¥","å ‚å¼Ÿ","å ‚å§","å ‚å¦¹","å”","ä¼¯","èˆ…","å§¨","å§‘"];
    const BLOCK_BESTIALITY = ["ç‹—","è²“","é¦¬","ç¸äº¤","å‹•ç‰©","å¯µç‰©"];
    const BLOCK_NONCONSENT = ["å¼·è¿«","å¼·ä¸Š","ç¡¬ä¸Š","è¿·å¥¸","ä¸‹è—¥","è¢«è¿«","ä¸æƒ…é¡˜","æ€§ä¾µ","å·æ‹"];
    function adultSafetyOk(s){
      const all = [...BLOCK_MINOR, ...BLOCK_INCEST, ...BLOCK_BESTIALITY, ...BLOCK_NONCONSENT];
      return !all.some(k=>s.includes(k));
    }

    // =============== ç”Ÿæˆé‚è¼¯ ===============
    function buildContext({kw, theme, styleText}){
      return {
        KW: kw || "",
        THEME: theme || "",
        NOUN: pick(LEX.NOUN),
        ADJ: pick(LEX.ADJ),
        VERB: pick(LEX.VERB),
        EMOJI: pick(LEX.EMOJI),
        OPEN: pick(FRAG.OPEN),
        CLAIM: pick(FRAG.CLAIM),
        TURN: pick(FRAG.TURN),
        PUNCH: replaceSmart(pick(FRAG.PUNCH), {KW: kw || "é€™ä»¶äº‹", NOUN: pick(LEX.NOUN)}),
        TAIL: pick(FRAG.TAIL)
      }
    }
    function fromTemplate(ctx, tplList=TEMPLATES){
      const tpl = pick(tplList);
      return replaceSmart(tpl, ctx);
    }

    function poolForTheme(theme, adultOn){
      // æˆäººä¸»é¡Œæ§åˆ¶ï¼šæœªé–‹å•Ÿæˆäººæ¨¡å¼ï¼Œé¸æˆäººä¸»é¡Œæ™‚å›é€€
      if(theme === "æˆäºº-é›™é—œ"){
        if(adultOn) return CORPUS_ADULT["æˆäºº-é›™é—œ"];
        return CORPUS["æƒ…æ„Ÿ"]; // å›é€€
      }
      if(theme === "æˆäºº-éœ²éª¨"){
        if(adultOn) return CORPUS_ADULT["æˆäºº-éœ²éª¨"];
        return CORPUS["æƒ…æ„Ÿ"]; // å›é€€
      }
      return CORPUS[theme] || [];
    }

    function dedupeLines(lines, mode="soft"){
      if(mode==="off") return lines;
      const seen = new Set();
      const out = [];
      for(const s of lines){
        const key = mode==="strict" ? s.replace(/[ï¼Œã€‚ã€ï¼!ï¼Ÿ?\s]/g,"") : s.replace(/[ã€‚.!?\s]/g,"");
        if(!seen.has(key)){ seen.add(key); out.push(s); }
      }
      return out;
    }

    function fromCorpus({theme, kw, creativity, adultOn}){
      const th = theme==="random" ? pick(Object.keys(CORPUS)) : theme;
      let pool = poolForTheme(th, adultOn);
      if(pool.length===0){ pool = [].concat(...Object.values(CORPUS)); }

      // ä»¥å‰µæ„åº¦æ±ºå®šæ¨¡æ¿/èªæ–™æ¯”ä¾‹
      const pTemplate = clamp((creativity/100), 0.25, 0.85);
      const useTpl = Math.random() < pTemplate;

      let sentence = "";
      if(useTpl){
        // æˆäººæ¨¡æ¿ï¼šä¾ä¸»é¡Œæ±ºå®š hint/explicit
        if(th==="æˆäºº-é›™é—œ" && adultOn){
          const ctx = buildContext({kw, theme: th});
          sentence = fromTemplate(ctx, TEMPLATES_ADULT.hint);
        }else if(th==="æˆäºº-éœ²éª¨" && adultOn){
          const ctx = buildContext({kw, theme: th});
          sentence = fromTemplate(ctx, TEMPLATES_ADULT.explicit);
        }else{
          const ctx = buildContext({kw, theme: th});
          sentence = fromTemplate(ctx);
        }
      }else{
        sentence = pick(pool);
        sentence = replaceSmart(sentence, {KW: kw || "", THEME: th});
      }
      // æˆäººæ¨¡å¼ä¸åšå…§å®¹å®‰å…¨éæ¿¾ï¼ˆä¾éœ€æ±‚ï¼‰
      sentence = filterDirty(sentence);
      return sentence;
    }

    function genLocal(){
      const themeSel = byId("theme").value;
      const themeCustom = byId("themeCustom").value.trim();
      const kw = byId("keyword").value.trim();
      const format = byId("format").value;
      let count = parseInt(byId("count").value || "1",10);
      const creativity = parseInt(byId("creativity").value||"60",10);
      const dedupeMode = byId("dedupe").value;
      const adultOn = byId("adultOn").checked;

      const thFinal = themeCustom || (themeSel==="random" ? "random" : themeSel);

      // è¦å‰‡ï¼šå°è¯å›ºå®š2å¥ï¼›å…¶ä»–æ ¼å¼å°Šé‡ä½¿ç”¨è€… countï¼ˆåŒ…å« posterï¼‰
      if(format==="couplet") count = 2;
      if(format==="single") count = 1;

      const lines = [];
      const triesMax = Math.max(20, count*3);
      let tries=0;
      while(lines.length < count && tries < triesMax){
        const s = fromCorpus({theme: thFinal, kw, creativity, adultOn});
        lines.push(s);
        tries++;
      }
      const deduped = dedupeLines(lines, dedupeMode);
      // è‹¥å»é‡å¾Œä¸è¶³é‡ï¼Œå†è£œé½Š
      while(deduped.length < count && tries < triesMax*2){
        deduped.push(fromCorpus({theme: thFinal, kw, creativity, adultOn}));
        tries++;
      }
      return {lines: deduped.slice(0, count), theme: thFinal, kw, format, adultOn};
    }

    // =============== è¼¸å‡ºæ ¼å¼åŒ– ===============
    function formatOutput({lines, format}){
      let text="";
      if(format==="single"){
        text = lines[0] || "";
      }else if(format==="list"){
        text = lines.map((s,i)=>`â€¢ ${s}`).join("\n");
      }else if(format==="paragraph"){
        text = lines.join(" ");
      }else if(format==="couplet"){
        const up = (lines[0]||"").replace(/^ä¸Šè¯[:ï¼š]?/,"");
        const down = (lines[1]||"").replace(/^ä¸‹è¯[:ï¼š]?/,"");
        text = `ä¸Šè¯ï¼š${up}\nä¸‹è¯ï¼š${down}`;
      }else if(format==="poster"){
        text = lines.map(s=>"ã€Œ"+s+"ã€").join("\n");
      }else{
        text = lines.join("\n");
      }
      return text.trim();
    }

    function updateTags(info){}

    // =============== UI ç¶å®šï¼šæ¨¡å¼åˆ‡æ› / å‹•æ…‹æ¬„ä½ ===============
    // é»æ“Šä¸»ä»‹é¢æ™‚é—œé–‰å°è¦–çª— + ä¿è­‰åŒæ™‚åªé–‹ä¸€å€‹
    const detailEls = [byId('aiDetails'), byId('adultDetails')].filter(Boolean);
    function closeAllDetails(){ detailEls.forEach(d=>{ if(d && d.open) d.open=false; }); }
    document.addEventListener('click', (e)=>{
      const withinDetails = e.target.closest && e.target.closest('details');
      if(!withinDetails){ closeAllDetails(); }
      // åƒ…å…è¨±å–®ä¸€ details é–‹å•Ÿ
      const opened = detailEls.filter(d=>d.open);
      if(opened.length>1){ opened.slice(1).forEach(d=>d.open=false); }
    });

    function refreshCountState(){
      const format = byId("format").value;
      const count = byId("count");
      const label = byId("countLabel");
      const themeSelect = byId('theme');
      const themeCustom = byId('themeCustom');
      const styleSelect = byId('style');
      const styleCustom = byId('styleCustom');
      if(format==="single"){
        count.disabled = true;
        label.textContent = "æ•¸é‡/å¥æ•¸ï¼ˆå–®å¥å›ºå®š 1ï¼‰";
      }else if(format==="couplet"){
        count.disabled = true;
        label.textContent = "æ•¸é‡/å¥æ•¸ï¼ˆå°è¯å›ºå®š 2ï¼‰";
      }else{
        count.disabled = false;
        label.textContent = "æ•¸é‡/å¥æ•¸";
      }
      // è‡ªå®šç¾©ä¸»é¡Œ/é¢¨æ ¼çš„è¼¸å…¥å•Ÿç”¨
      if(themeSelect && themeCustom){ themeCustom.disabled = themeSelect.value !== 'custom'; }
      if(styleSelect && styleCustom){ styleCustom.disabled = styleSelect.value !== 'custom'; }
    }
    byId("format").addEventListener("change", refreshCountState);
    byId("theme").addEventListener("change", refreshCountState);
    byId("style").addEventListener("change", refreshCountState);
    // é¦–æ¬¡è¼‰å…¥æ™‚å¥—ç”¨ä¸»é¡Œ/é¢¨æ ¼è‡ªå®šç¾© disable ç‹€æ…‹
    refreshCountState();

    // =============== æœ¬åœ°æ¨¡å¼ï¼šç”Ÿæˆ / éš¨æ©Ÿ / æ¸…ç©º ===============
    async function genAIUsingMainInputs(){
      const base = byId("apiBase").value.trim() || "https://api.openai.com/v1";
      const key = byId("apiKey").value.trim();
      const model = byId("apiModel").value.trim() || "gpt-4o-mini";
      const themeSel = byId("theme").value;
      const themeCustom = byId("themeCustom").value.trim();
      const kw = byId("keyword").value.trim();
      const format = byId("format").value;
      let n = parseInt(byId("count").value||"4",10);
      const creativity = parseInt(byId("creativity").value||"60",10);
      const dedupeMode = byId("dedupe").value;
      const adultOn = byId("adultOn").checked;
      if(format==="single") n = 1; else if(format==="couplet") n = 2;
      if(!key){ toast("è«‹è¼¸å…¥ API Key"); return; }

      // ä¿å­˜ AI è¨­å®š
      setLocal("AI__base", base);
      setLocal("AI__model", model);
      setLocal("AI__key", key);
      setLocal("AI__adultOn", adultOn);

      const theme = themeCustom || (themeSel==="random"? "" : themeSel);
      const sys = buildSystemPrompt({adultOn, theme});
      const styleSel = byId('style').value;
      const styleCustom = byId('styleCustom').value.trim();
      const styleText = styleCustom || (styleSel && styleSel!=='æ­£å¸¸' ? styleSel : '');
      const user = `ä»¥ã€Œ${theme || 'å¹¹è©±'}ã€ç‚ºä¸»é¡Œï¼Œçµåˆé—œéµå­—ã€Œ${kw || 'ï¼ˆç„¡ï¼‰'}ã€ï¼Œè«‹ç”¢ç”Ÿ ${n} å¥${adultOn?"æˆäºº":"å¹¹è©±"}ã€‚è¦æ±‚ï¼šæ¯å¥éƒ½è¦ã€Œçœ‹ä¼¼åˆç†ã€å¯¦å‰‡ç„¡ç”¨ã€ï¼Œé¿å…æä¾›å¯åŸ·è¡Œå»ºè­°ï¼›è‡ªç„¶åµŒå…¥é—œéµå­—${styleText?`ï¼Œæ•´é«”é¢¨æ ¼å‘ˆç¾ã€Œ${styleText}ã€`:''}ï¼›åš´ç¦åˆ—èˆ‰æˆ–ç·¨è™Ÿã€é¿å…ä»»ä½•å¼•è™Ÿï¼Œåªè¼¸å‡ºå¥å­æœ¬èº«ã€‚`;

      const payload = {
        model,
        temperature: Math.max(0, Math.min(1, creativity/100)),
        n: 1,
        max_tokens: 800,
        messages: [
          {role:"system", content: sys},
          {role:"user", content: user}
        ]
      };

      const controller = new AbortController();
      aiAbort = controller;
      toastLoading("AI ç”Ÿæˆä¸­...");
      try{
        const res = await fetch(`${base}/chat/completions`, {
          method:"POST",
          headers:{"Content-Type":"application/json","Authorization":`Bearer ${key}`},
          body: JSON.stringify(payload),
          signal: controller.signal
        });
        if(!res.ok){ const t=await res.text(); throw new Error(`API éŒ¯èª¤ï¼š${res.status} ${t}`); }
        const json = await res.json();
        let content = json.choices?.[0]?.message?.content || "";
        let lines = content.split(/\r?\n/).map(s=>s.trim()).filter(Boolean)
          .map(s=>s.replace(/^[-â€¢\d]+\s*/,""))
          .map(s=>s.replace(/^([ã€Œâ€œ"'])(.*)([ã€â€"'])$/,'$2'));
        lines = dedupeLines(lines, dedupeMode);
        if(lines.length>n) lines = lines.slice(0,n);
        lines = lines.map(filterDirty);
        await typeLines(byId("output"), lines, 14, 120);
      }catch(err){
        if(err.name!=="AbortError"){ console.error(err); toast("AI ç”Ÿæˆå¤±æ•—ï¼š"+err.message); }
      }finally{
        toastDone();
        aiAbort=null;
      }
    }

    byId("btn-gen-local").addEventListener("click", async ()=>{
      const useAI = !!byId("aiEnabled") && byId("aiEnabled").checked;
      if(useAI){ await genAIUsingMainInputs(); return; }
      const res = genLocal();
      let out = formatOutput(res);
      out = sanitizeTextByFormat(out, res.format);
      updateTags(res);
      const lines = out.split(/\n/);
      await typeLines(byId("output"), lines, 14, 120);
    });

    byId("btn-rand").addEventListener("click", ()=>{
      byId("theme").selectedIndex = rand(byId("theme").options.length);
      const kws = ["é˜¿å®","é˜¿èŠ¬","ä¿æº«ç“¶","æ»‘é¼ ","ä¸»ç®¡","æ™šè‡ªç¿’","KPI","OKR","çºŒå‘½å’–å•¡","é€±æœƒ","æƒ…ç·’åƒ¹å€¼","ä¾¿åˆ©è²¼"];
      byId("keyword").value = Math.random()<0.6 ? pick(kws) : "";
      const fmts = ["single","list","paragraph","poster","couplet"];
      byId("format").value = pick(fmts);
      byId("count").value = 2 + rand(5);
      byId("creativity").value = 40 + rand(61);
      byId("dedupe").value = pick(["soft","strict","off"]);
      byId("adultOn").checked = Math.random() < 0.5;
      refreshCountState();
      toast("å·²éš¨æ©Ÿèª¿å¥½é…æ–¹");
    });

    byId("btn-clear").addEventListener("click", ()=>{
      $("#output").textContent="";
      $("#tags-info").innerHTML="";
    });

    // =============== ä¸€éµè¤‡è£½ / Share ===============
    byId("btn-copy-all").addEventListener("click", async ()=>{
      const text = $("#output").textContent.trim();
      if(!text){ toast("æ²’æœ‰å…§å®¹å¯è¤‡è£½"); return; }
      try{
        await navigator.clipboard.writeText(text);
        toast("å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿");
      }catch(e){
        toast("è¤‡è£½å¤±æ•—");
      }
    });

    // å·²å–æ¶ˆåˆ†äº«åŠŸèƒ½

    // =============== è¨­å®šæŒä¹…åŒ–ï¼ˆå³æ™‚ï¼‰ ===============
    // ä¿å­˜ AI & æˆäººè¨­å®š + AI é–‹é—œ
    ["apiBase","apiModel","apiKey"].forEach(id=>{
      const el = byId(id);
      if(!el) return;
      el.addEventListener("input", ()=>{
        const v = (el.value||"").trim();
        setLocal(`AI__${id.replace('api','').toLowerCase()}`, v);
      });
    });
    const aiEnabledEl = byId("aiEnabled"); if(aiEnabledEl){ aiEnabledEl.addEventListener("change", e=> setLocal("AI__aiEnabled", e.target.checked)); }
    ["adultOn","adultFull"].forEach(id=>{ const el=byId(id); if(el){ el.addEventListener("change", e=> setLocal(`AI__${id}`, e.target.checked)); }});

    // =============== AI æ¨¡å¼ï¼šç³»çµ±æç¤ºè©ï¼ˆä¾æˆäººæ¨¡å¼è‡ªå‹•ï¼‰ ===============
    const buildSystemPrompt = ({adultOn, theme})=>{
      const styleSel = byId('style').value;
      const styleCustom = byId('styleCustom').value.trim();
      const styleText = styleCustom || (styleSel && styleSel!=='æ­£å¸¸' ? styleSel : '');
      const adultFull = !!byId('adultFull') && byId('adultFull').checked;
      return buildSystemPromptFromState({adultOn, adultFull, theme, customAdult: byId('adultCustomPrompt')?.value || '', styleText});
    };

    let aiAbort = null;
    const btnGenAI = byId("btn-gen-ai");
    const btnAIStop = byId("btn-ai-stop");
    if(btnGenAI){ btnGenAI.addEventListener("click", async ()=>{
      const base = byId("apiBase").value.trim() || "https://api.openai.com/v1";
      const key = byId("apiKey").value.trim();
      const model = byId("apiModel").value.trim() || "gpt-4o-mini";
      const theme = byId("aiTheme").value.trim();
      const kw = byId("aiKeyword").value.trim();
      const n = parseInt(byId("aiCount").value||"6",10);
      const temp = parseInt(byId("aiTemp").value||"70",10)/100;
      const dedupeMode = byId("aiDedupe").value;
      const adultOn = byId("adultOn").checked;
      if(!key){ toast("è«‹è¼¸å…¥ API Key"); return; }
      // ä¿å­˜ AI è¨­å®š
      setLocal("AI__base", base);
      setLocal("AI__model", model);
      setLocal("AI__key", key);
      setLocal("AI__adultOn", adultOn);

      const sys = (byId("aiCustomSystem").value.trim() || buildSystemPrompt({adultOn, theme}));
      const user = `è«‹ç”¢ç”Ÿ ${n} å¥${adultOn?"æˆäºº":"å¹¹è©±"}ã€‚é—œéµå­—ï¼ˆå¯ç•™ç©ºï¼‰ï¼š${kw ? kw : "ï¼ˆç„¡ï¼‰"}`;

      const payload = {
        model, temperature: temp, n: 1, max_tokens: 800,
        messages: [
          {role:"system", content: sys},
          {role:"user", content: user}
        ]
      };

      const controller = new AbortController();
      aiAbort = controller;
      if(btnGenAI) btnGenAI.classList.add("hidden");
      if(btnAIStop) btnAIStop.classList.remove("hidden");
      try{
        const res = await fetch(`${base}/chat/completions`, {
          method:"POST",
          headers:{
            "Content-Type":"application/json",
            "Authorization":`Bearer ${key}`
          },
          body: JSON.stringify(payload),
          signal: controller.signal
        });
        if(!res.ok){
          const t=await res.text();
          throw new Error(`API éŒ¯èª¤ï¼š${res.status} ${t}`);
        }
        const json = await res.json();
        let content = json.choices?.[0]?.message?.content || "";
        let lines = content.split(/\r?\n/).map(s=>s.trim()).filter(Boolean)
          .map(s=>s.replace(/^[-â€¢\d]+\s*/,""))
          .map(s=>s.replace(/^([ã€Œâ€œ"'])(.*)([ã€â€"'])$/,'$2'))
          .filter(Boolean);
        // å»é‡
        lines = dedupeLines(lines, dedupeMode);
        if(lines.length>n) lines = lines.slice(0,n);
        lines = lines.map(filterDirty);
        // æ¨™é»ä¿®å¾©
        lines = sanitizeLines(lines);
        const out = formatOutput({lines, format:"list"});
        await typeLines(byId("output"), out.split(/\n/), 14, 120);
        updateTags({theme: theme || (adultOn?"æˆäºº":undefined), kw, format:"list"});
      }catch(err){
        if(err.name!=="AbortError"){
          console.error(err);
          toast("AI ç”Ÿæˆå¤±æ•—ï¼š"+err.message);
        }
      }finally{
        if(btnGenAI) btnGenAI.classList.remove("hidden");
        if(btnAIStop) btnAIStop.classList.add("hidden");
        aiAbort = null;
      }
    }); }
    if(btnAIStop){ btnAIStop.addEventListener("click", ()=>{ if(aiAbort){ aiAbort.abort(); toast("å·²åœæ­¢"); } }); }

    // =============== Console æŒ‡ä»¤ï¼šé¡¯ç¤ºç›®å‰æç¤ºè©ï¼ˆSystem/Userï¼‰ ===============
    // ç”¨æ³•ï¼š
    // ghPrompt()                           // ä¾ç›®å‰ä»‹é¢è¨­å®šè¼¸å‡º System/User æç¤ºè©
    // ghPrompt({ theme:"è‡ªå®šä¸»é¡Œ", kw:"é—œéµå­—", n:6, style:"æ¯’èˆŒ", adultOn:true, adultFull:false }) // è¦†å¯«é è¨­
    function computeStyleText(){
      const styleSel = byId('style')?.value || '';
      const styleCustom = byId('styleCustom')?.value?.trim() || '';
      return styleCustom || (styleSel && styleSel!== 'æ­£å¸¸' && styleSel!== 'custom' ? styleSel : '');
    }
    function computeTheme(){
      const sel = byId('theme')?.value || 'random';
      const custom = byId('themeCustom')?.value?.trim() || '';
      if(sel === 'custom') return custom;
      if(sel === 'random') return '';
      return sel;
    }
    function computeN(){
      const fmt = byId('format')?.value || 'list';
      let n = parseInt(byId('count')?.value||'4',10);
      if(fmt === 'single') n = 1; else if(fmt === 'couplet') n = 2;
      return n;
    }
    function buildUserPrompt({n, adultOn, theme, kw, styleText}){
      return `ä»¥ã€Œ${theme || 'å¹¹è©±'}ã€ç‚ºä¸»é¡Œï¼Œçµåˆé—œéµå­—ã€Œ${kw || 'ï¼ˆç„¡ï¼‰'}ã€ï¼Œè«‹ç”¢ç”Ÿ ${n} å¥${adultOn?"æˆäºº":"å¹¹è©±"}ã€‚è¦æ±‚ï¼šæ¯å¥éƒ½è¦ã€Œçœ‹ä¼¼åˆç†ã€å¯¦å‰‡ç„¡ç”¨ã€ï¼Œé¿å…æä¾›å¯åŸ·è¡Œå»ºè­°ï¼›è‡ªç„¶åµŒå…¥é—œéµå­—${styleText?`ï¼Œæ•´é«”é¢¨æ ¼å‘ˆç¾ã€Œ${styleText}ã€`:''}ï¼›åš´ç¦åˆ—èˆ‰æˆ–ç·¨è™Ÿã€é¿å…ä»»ä½•å¼•è™Ÿï¼Œåªè¼¸å‡ºå¥å­æœ¬èº«ã€‚`;
    }
    window.ghPrompt = (overrides={})=>{
      const adultOn = overrides.adultOn != null ? !!overrides.adultOn : !!(byId('adultOn')?.checked);
      const adultFull = overrides.adultFull != null ? !!overrides.adultFull : !!(byId('adultFull')?.checked);
      const theme = overrides.theme != null ? overrides.theme : computeTheme();
      const kw = overrides.kw != null ? overrides.kw : (byId('keyword')?.value?.trim() || '');
      const styleText = overrides.style != null ? overrides.style : computeStyleText();
      const n = overrides.n != null ? overrides.n : computeN();
      const sys = buildSystemPromptFromState({ adultOn, adultFull, theme, customAdult: byId('adultCustomPrompt')?.value || '', styleText });
      const user = buildUserPrompt({ n, adultOn, theme, kw, styleText });
      console.log('[System Prompt]\n'+sys+'\n\n[User Prompt]\n'+user);
      return { system: sys, user };
    };

    function measureWrappedText(text, maxWidth, font, lineHeightPx, align){
      ctx.font = font; ctx.textAlign = align || "left"; ctx.textBaseline = "top";
      const linesOut = [];
      const paragraphs = text.split(/\n+/).map(s=>s.trim()).filter(s=>s.length>0);
      for(const p of paragraphs){
        // ä¸­æ–‡é€å­—ã€è‹±æ–‡å–®è©æ··åˆæ›è¡Œ
        let line = "";
        const tokens = /[\p{Script=Han}ã€‚ï¼Œã€ï¼Ÿï¼ï¼šï¼›ï¼ˆï¼‰ã€Œã€ã€ã€ã€ã€‘ã€Šã€‹â€¦â€”]|[^\s\p{Script=Han}ã€‚ï¼Œã€ï¼Ÿï¼ï¼šï¼›ï¼ˆï¼‰ã€Œã€ã€ã€ã€ã€‘ã€Šã€‹â€¦â€”]+/gu;
        const parts = p.match(tokens) || [p];
        for(const part of parts){
          const test = line + part;
          if(ctx.measureText(test).width > maxWidth){
            if(line) linesOut.push(line);
            // è‹¥å–®å€‹ part è¶…å¯¬ï¼Œåšä¸­æ–·
            if(ctx.measureText(part).width > maxWidth){
              let sub=""; for(const ch of part){
                const t2=sub+ch;
                if(ctx.measureText(t2).width>maxWidth){ linesOut.push(sub); sub=ch; } else { sub=t2; }
              }
              if(sub) line=sub;
            }else{
              line = part;
            }
          }else{
            line = test;
          }
        }
        if(line) linesOut.push(line);
        linesOut.push(""); // æ®µè½ç©ºè¡Œ
      }
      if(linesOut.length && linesOut[linesOut.length-1]==="") linesOut.pop();
      const height = linesOut.reduce((h, ln)=>h + (ln===""? lineHeightPx*0.6 : lineHeightPx), 0);
      return {lines: linesOut, height};
    }

    function drawTextBlock(opts){
      const {text, style, padding, fontScale, watermark, align, lineHeight, strokeWidth, maskRadius, autoFit} = opts;
      const W=parseInt(canvas.style.width), H=parseInt(canvas.style.height);
      let content = text.trim() || "å…ˆç”Ÿæˆå¹¹è©±ï¼Œå†åšæˆåœ–ã€‚";
      const base = Math.round((Math.min(W,H)/24) * (fontScale/100));
      const linePx = Math.max(14, Math.round(base * (lineHeight/100)));
      // èƒŒæ™¯é®ç½©
      if(style!=="meme"){
        ctx.fillStyle="rgba(0,0,0,0.22)";
        roundRect(ctx, padding, padding, W-2*padding, H-2*padding, maskRadius, true, false);
      }
      if(style==="meme"){
        // MEMEï¼šä¸Š/ä¸‹
        const lines = content.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
        const top = (lines[0]||"ä¸Šæ–¹é‚£å¥").toUpperCase();
        const bottom = (lines.length>1? lines[lines.length-1] : "ä¸‹æ–¹é‚£å¥").toUpperCase();
        const drawImpact = (t, y)=>{
          let fs = base*1.25;
          ctx.textAlign="center"; ctx.textBaseline="top";
          ctx.fillStyle="#fff"; ctx.strokeStyle="#000";
          // è‡ªå‹•é©é…
          while(ctx.measureText(t).width > W - padding*2){ fs -= 2; ctx.font = `bold ${fs}px Impact, Arial Black, system-ui, sans-serif`; }
          ctx.font = `bold ${fs}px Impact, Arial Black, system-ui, sans-serif`;
          ctx.lineWidth = Math.max(2, strokeWidth || Math.round(fs*0.08));
          // åˆ†è¡Œ
          const arr = wrapForMeme(t, W - padding*2, fs);
          let yy = y;
          for(const line of arr){
            ctx.strokeText(line, W/2, yy);
            ctx.fillText(line, W/2, yy);
            yy += fs*1.15;
          }
        };
        drawImpact(top, padding*0.8);
        drawImpact(bottom, H - padding*0.8 - base*1.2*wrapForMeme(bottom, W-padding*2, base*1.15).length);
      }else if(style==="quote"){
        let fs = base*1.05;
        let font = `600 ${fs}px system-ui, "Noto Sans TC", sans-serif`;
        let measure = measureWrappedText(content, W - padding*2.2, font, linePx, align);
        if(autoFit==="on"){
          while((measure.height > H - padding*2.2) && fs>12){
            fs -= 1;
            font = `600 ${fs}px system-ui, "Noto Sans TC", sans-serif`;
            measure = measureWrappedText(content, W - padding*2.2, font, Math.max(12, Math.round(fs*lineHeight/100)), align);
          }
        }
        ctx.font = font;
        ctx.textAlign = align; ctx.textBaseline="top";
        ctx.fillStyle = "#fff"; ctx.strokeStyle = "rgba(0,0,0,0.65)";
        ctx.lineWidth = strokeWidth;
        // å¼•è™Ÿ
        ctx.shadowColor="rgba(0,0,0,.5)"; ctx.shadowBlur=8; ctx.shadowOffsetY=2;
        ctx.fillText("â€œ", align==="left"? padding*1.3 : (align==="center"? W/2 : W - padding*1.3), padding*1.0);
        // å…§å®¹
        ctx.shadowBlur=0; ctx.shadowOffsetY=0;
        let y = padding*1.6;
        const startX = align==="left"? padding*1.3 : (align==="center"? W/2 : W - padding*1.3);
        for(const line of measure.lines){
          if(line===""){ y += linePx*0.6; continue; }
          if(strokeWidth>0) ctx.strokeText(line, startX, y);
          ctx.fillText(line, startX, y);
          y += linePx;
        }
      }else{ // poster
        let fs = base*1.15;
        let font = `800 ${fs}px system-ui, "Noto Sans TC", sans-serif`;
        let measure = measureWrappedText(content, W - padding*2.2, font, linePx, align);
        if(autoFit==="on"){
          while((measure.height > H - padding*2.2) && fs>12){
            fs -= 1;
            font = `800 ${fs}px system-ui, "Noto Sans TC", sans-serif`;
            measure = measureWrappedText(content, W - padding*2.2, font, Math.max(12, Math.round(fs*lineHeight/100)), align);
          }
        }
        ctx.font = font;
        ctx.textAlign = align; ctx.textBaseline="top";
        ctx.fillStyle = "#fff"; ctx.strokeStyle = "rgba(0,0,0,0.75)";
        ctx.lineWidth = strokeWidth;
        let y = (H - measure.height)/2;
        const startX = align==="left"? padding*1.2 : (align==="center"? W/2 : W - padding*1.2);
        for(const line of measure.lines){
          if(line===""){ y += linePx*0.6; continue; }
          if(strokeWidth>0) ctx.strokeText(line, startX, y);
          ctx.fillText(line, startX, y);
          y += linePx;
        }
      }
      // æµ®æ°´å°
      if(watermark){
        ctx.save();
        ctx.globalAlpha=0.85;
        const wmSize = Math.round(base*0.72);
        ctx.font = `600 ${wmSize}px system-ui, "Noto Sans TC", sans-serif`;
        ctx.fillStyle="rgba(255,255,255,0.88)";
        ctx.textAlign="right"; ctx.textBaseline="bottom";
        ctx.fillText(watermark, W - padding, H - padding*0.8);
        ctx.restore();
      }
    }

    function wrapForMeme(text, maxWidth, fs){
      const words = text.split(/\s+/);
      let lines = []; let line="";
      ctx.font = `bold ${fs}px Impact, Arial Black, system-ui, sans-serif`;
      for(let i=0;i<words.length;i++){
        const w = words[i];
        const test = line ? line + " " + w : w;
        if(ctx.measureText(test).width > maxWidth){
          if(line) lines.push(line);
          line = w;
        }else{
          line = test;
        }
      }
      if(line) lines.push(line);
      if(lines.length===1 && /\p{Script=Han}/u.test(text) && !/\s/.test(text)){
        // ä¸­æ–‡é€å­—åˆ†å‰²
        const arr = []; let cur="";
        for(const ch of text){
          const t = cur+ch;
          if(ctx.measureText(t).width > maxWidth){ arr.push(cur); cur=ch; } else { cur=t; }
        }
        if(cur) arr.push(cur);
        return arr;
      }
      return lines;
    }

    function roundRect(ctx, x, y, w, h, r, fill, stroke){
      if (w < 2 * r) r = w / 2;
      if (h < 2 * r) r = h / 2;
      ctx.beginPath();
      ctx.moveTo(x+r, y);
      ctx.arcTo(x+w, y, x+w, y+h, r);
      ctx.arcTo(x+w, y+h, x, y+h, r);
      ctx.arcTo(x, y+h, x, y, r);
      ctx.arcTo(x, y, x+w, y, r);
      ctx.closePath();
      if (fill) ctx.fill();
      if (stroke) ctx.stroke();
    }

    // =============== é è¨­ç”Ÿæˆ ===============
    (function init(){
      // è¼‰å…¥ LocalStorage è¨­å®šï¼ˆAI èˆ‡æˆäººæ¨¡å¼ï¼‰
      const savedBase = getLocal("AI__base", "https://api.openai.com/v1");
      const savedModel = getLocal("AI__model", "gpt-4o-mini");
      const savedKey = getLocal("AI__key", "");
      const savedAdult = getLocal("AI__adultOn", false);
      const savedAdultFull = getLocal("AI__adultFull", false);
      const savedAiEnabled = getLocal("AI__aiEnabled", false);
      if(savedBase) byId("apiBase").value = savedBase;
      if(savedModel) byId("apiModel").value = savedModel;
      if(typeof savedKey === 'string') byId("apiKey").value = savedKey;
      byId("adultOn").checked = !!savedAdult;
      const adultFullEl = byId("adultFull"); if(adultFullEl) adultFullEl.checked = !!savedAdultFull;
      const aiEnabledEl2 = byId("aiEnabled"); if(aiEnabledEl2) aiEnabledEl2.checked = !!savedAiEnabled;

      const res = genLocal();
      const out = formatOutput(res);
      $("#output").textContent = out;
      updateTags(res);
      makeImageFromOutput();
    })();
  </script>
</body>
</html>