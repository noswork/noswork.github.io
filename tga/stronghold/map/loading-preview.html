<!DOCTYPE html>
<!--
  Copyright Â© 2025 nos
  All Rights Reserved.
  
  æœªç¶“æˆæ¬Šï¼Œç¦æ­¢ä½¿ç”¨ã€è¤‡è£½ã€ä¿®æ”¹æˆ–åˆ†ç™¼æœ¬ä»£ç¢¼ã€‚
  Unauthorized copying, modification, or distribution is strictly prohibited.
  
  Contact: discord: noswork
-->
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>å°å‡ºå‹•ç•«é è¦½ | Loading Animation Preview</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/favicon/favicon.ico" />
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png" />
    
    <style>
      /* åŸºç¤æ¨£å¼ */
      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: "Inter", "Segoe UI", "PingFang TC", system-ui, -apple-system, sans-serif;
        background: #0e1420;
        overflow-x: hidden;
      }

      /* CSS Variables */
      :root {
        color-scheme: dark;
        --panel-bg: rgba(18, 25, 38, 0.92);
        --panel-border: rgba(255, 255, 255, 0.08);
        --panel-text: #f0f6ff;
        --panel-muted: #90a4c0;
        --outline-color: rgba(111, 167, 255, 0.8);
      }

      /* Light Theme */
      :root[data-theme="light"] {
        color-scheme: light;
        --panel-bg: rgba(248, 250, 252, 0.95);
        --panel-border: rgba(0, 0, 0, 0.08);
        --panel-text: #1e293b;
        --panel-muted: #64748b;
        --outline-color: rgba(59, 130, 246, 0.6);
      }

      :root[data-theme="light"] body {
        background: #e8eef5;
      }

      /* èƒŒæ™¯ç´‹ç† */
      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background: url('assets/background.png') center/cover no-repeat,
                    linear-gradient(135deg, rgba(14, 20, 32, 0.88) 0%, rgba(14, 20, 32, 0.82) 100%);
        pointer-events: none;
      }

      :root[data-theme="light"] body::before {
        background: url('assets/background.png') center/cover no-repeat,
                    linear-gradient(135deg, rgba(232, 238, 245, 0.9) 0%, rgba(232, 238, 245, 0.85) 100%);
      }

      /* ä¸»å®¹å™¨ */
      .container {
        position: relative;
        z-index: 1;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 32px;
      }

      /* æ¨™é¡Œå€åŸŸ */
      .header {
        text-align: center;
        margin-bottom: 48px;
      }

      .header h1 {
        margin: 0 0 12px 0;
        font-size: 32px;
        font-weight: 700;
        color: var(--panel-text);
      }

      .header p {
        margin: 0;
        font-size: 16px;
        color: var(--panel-muted);
      }

      /* Loading å‹•ç•«æ¨£å¼ */
      .export-loading-overlay {
        position: fixed;
        inset: 0;
        z-index: 9999;
        background: rgba(14, 20, 32, 0.95);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 1;
        pointer-events: auto;
        transition: opacity 300ms ease;
      }

      :root[data-theme="light"] .export-loading-overlay {
        background: rgba(232, 238, 245, 0.95);
      }

      .export-loading-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 32px;
        max-width: 500px;
        padding: 48px;
        background: var(--panel-bg);
        border: 1px solid var(--panel-border);
        border-radius: 24px;
        box-shadow: 0 24px 60px rgba(0, 0, 0, 0.5);
        text-align: center;
      }

      .export-loading-animation {
        position: relative;
        width: 200px;
        height: 200px;
        border-radius: 16px;
        overflow: hidden;
        background: rgba(0, 0, 0, 0.3);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
      }

      .export-loading-gif {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .export-loading-text {
        display: flex;
        flex-direction: column;
        gap: 12px;
        width: 100%;
      }

      .export-loading-title {
        font-size: 22px;
        font-weight: 700;
        color: var(--panel-text);
        margin: 0;
        letter-spacing: 0.02em;
      }

      .export-loading-subtitle {
        font-size: 14px;
        font-weight: 500;
        color: var(--panel-muted);
        margin: 0;
      }

      .export-loading-progress {
        width: 100%;
        height: 8px;
        background: rgba(255, 255, 255, 0.08);
        border-radius: 999px;
        overflow: hidden;
        position: relative;
      }

      :root[data-theme="light"] .export-loading-progress {
        background: rgba(0, 0, 0, 0.08);
      }

      .export-loading-progress-bar {
        height: 100%;
        background: linear-gradient(90deg, 
          rgba(104, 162, 255, 0.9) 0%,
          rgba(142, 93, 255, 0.9) 50%,
          rgba(104, 162, 255, 0.9) 100%
        );
        background-size: 200% 100%;
        border-radius: 999px;
        width: 0%;
        transition: width 300ms ease;
        animation: progressShine 2s ease-in-out infinite;
        box-shadow: 0 0 20px rgba(104, 162, 255, 0.6);
      }

      @keyframes progressShine {
        0% {
          background-position: 200% 0;
        }
        100% {
          background-position: -200% 0;
        }
      }

      /* æ§åˆ¶æŒ‰éˆ•å€åŸŸ */
      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        justify-content: center;
        margin-top: 32px;
      }

      .btn {
        padding: 12px 24px;
        font-size: 14px;
        font-weight: 600;
        color: var(--panel-text);
        background: var(--panel-bg);
        border: 1px solid var(--panel-border);
        border-radius: 12px;
        cursor: pointer;
        transition: all 200ms ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn-primary {
        background: linear-gradient(135deg, rgba(104, 162, 255, 0.92), rgba(142, 93, 255, 0.9));
        border-color: rgba(255, 255, 255, 0.2);
        color: #ffffff;
      }

      .progress-info {
        margin-top: 8px;
        font-size: 12px;
        color: var(--panel-muted);
        text-align: center;
      }

      /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
      @media (max-width: 768px) {
        .header h1 {
          font-size: 24px;
        }

        .header p {
          font-size: 14px;
        }

        .export-loading-content {
          padding: 32px 24px;
          margin: 16px;
        }

        .export-loading-animation {
          width: 160px;
          height: 160px;
        }

        .export-loading-title {
          font-size: 18px;
        }

        .export-loading-subtitle {
          font-size: 13px;
        }

        .controls {
          flex-direction: column;
          width: 100%;
          max-width: 300px;
        }

        .btn {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ¬ å°å‡ºå‹•ç•«é è¦½</h1>
        <p>Loading Animation Preview for Map Export</p>
      </div>

      <!-- Loading å‹•ç•« -->
      <div id="export-loading" class="export-loading-overlay">
          <div class="export-loading-content">
            <div class="export-loading-animation">
              <img id="loading-gif" 
                   src="" 
                   alt="Tokyo Ghoul Loading Animation" 
                   class="export-loading-gif">
            </div>
            <div class="export-loading-text">
            <h2 class="export-loading-title" id="loading-title">æ­£åœ¨å°å‡ºåœ°åœ–...</h2>
            <p class="export-loading-subtitle" id="loading-subtitle">è«‹ç¨å€™ï¼Œæ­£åœ¨è™•ç†åœ–ç‰‡</p>
          </div>
          <div class="export-loading-progress">
            <div id="export-progress-bar" class="export-loading-progress-bar"></div>
          </div>
          <div class="progress-info">
            <span id="progress-text">é€²åº¦ï¼š0%</span>
          </div>
        </div>
      </div>

      <!-- æ§åˆ¶æŒ‰éˆ• -->
      <div class="controls">
        <button class="btn btn-primary" onclick="simulateProgress()">
          â–¶ï¸ æ¨¡æ“¬é€²åº¦
        </button>
        <button class="btn" onclick="loadRandomGif()">
          ğŸ² éš¨æ©Ÿæ›åœ–
        </button>
        <button class="btn" onclick="resetProgress()">
          ğŸ”„ é‡ç½®
        </button>
        <button class="btn" onclick="toggleTheme()">
          ğŸ¨ åˆ‡æ›ä¸»é¡Œ
        </button>
        <button class="btn" onclick="toggleLanguage()">
          ğŸŒ åˆ‡æ›èªè¨€
        </button>
      </div>
    </div>

    <script>
      let currentProgress = 0;
      let currentLanguage = 'zh-TW';
      let progressInterval = null;

      const translations = {
        'zh-TW': {
          title: 'æ­£åœ¨å°å‡ºåœ°åœ–...',
          subtitle: 'è«‹ç¨å€™ï¼Œæ­£åœ¨è™•ç†åœ–ç‰‡',
          progress: 'é€²åº¦ï¼š'
        },
        'en': {
          title: 'Exporting Map...',
          subtitle: 'Please wait, processing images',
          progress: 'Progress: '
        }
      };

      // æ¨¡æ“¬é€²åº¦
      function simulateProgress() {
        resetProgress();
        
        const steps = [
          { progress: 10, delay: 200 },
          { progress: 20, delay: 300 },
          { progress: 30, delay: 400 },
          { progress: 50, delay: 600 },
          { progress: 60, delay: 300 },
          { progress: 70, delay: 400 },
          { progress: 85, delay: 500 },
          { progress: 95, delay: 300 },
          { progress: 100, delay: 400 }
        ];

        let index = 0;
        
        function nextStep() {
          if (index >= steps.length) return;
          
          const step = steps[index];
          updateProgress(step.progress);
          index++;
          
          setTimeout(nextStep, step.delay);
        }

        nextStep();
      }

      // æ›´æ–°é€²åº¦
      function updateProgress(percent) {
        currentProgress = percent;
        const progressBar = document.getElementById('export-progress-bar');
        const progressText = document.getElementById('progress-text');
        
        if (progressBar) {
          progressBar.style.width = `${percent}%`;
        }
        
        if (progressText) {
          progressText.textContent = `${translations[currentLanguage].progress}${percent}%`;
        }
      }

      // é‡ç½®é€²åº¦
      function resetProgress() {
        updateProgress(0);
      }

      // åˆ‡æ›ä¸»é¡Œ
      function toggleTheme() {
        const root = document.documentElement;
        const currentTheme = root.getAttribute('data-theme');
        
        if (currentTheme === 'light') {
          root.removeAttribute('data-theme');
        } else {
          root.setAttribute('data-theme', 'light');
        }
      }

      // åˆ‡æ›èªè¨€
      function toggleLanguage() {
        currentLanguage = currentLanguage === 'zh-TW' ? 'en' : 'zh-TW';
        
        const title = document.getElementById('loading-title');
        const subtitle = document.getElementById('loading-subtitle');
        const progressText = document.getElementById('progress-text');
        
        if (title) {
          title.textContent = translations[currentLanguage].title;
        }
        
        if (subtitle) {
          subtitle.textContent = translations[currentLanguage].subtitle;
        }
        
        if (progressText) {
          progressText.textContent = `${translations[currentLanguage].progress}${currentProgress}%`;
        }
      }

      // éš¨æ©Ÿé¸æ“‡ GIF
      let cachedGifList = null;
      async function loadRandomGif() {
        try {
          const loadingGif = document.getElementById('loading-gif');
          
          // å¦‚æœé‚„æ²’æœ‰åŠ è¼‰ GIF åˆ—è¡¨ï¼Œå‰‡åŠ è¼‰å®ƒ
          if (!cachedGifList) {
            const response = await fetch('data/gif-index.json');
            if (response.ok) {
              cachedGifList = await response.json();
              console.log(`âœ… å·²è¼‰å…¥ ${cachedGifList.length} å€‹ Tokyo Ghoul GIF`);
            } else {
              console.warn('âš ï¸ ç„¡æ³•è¼‰å…¥ GIF åˆ—è¡¨');
              return;
            }
          }
          
          // éš¨æ©Ÿé¸æ“‡ä¸€å€‹ GIF
          if (cachedGifList && cachedGifList.length > 0 && loadingGif) {
            const randomIndex = Math.floor(Math.random() * cachedGifList.length);
            const gifFilename = cachedGifList[randomIndex];
            loadingGif.src = `assets/loading-gifs/${gifFilename}`;
            console.log(`ğŸ¬ å·²è¼‰å…¥éš¨æ©Ÿ GIF: ${gifFilename}`);
          }
        } catch (error) {
          console.error('âŒ è¼‰å…¥éš¨æ©Ÿ GIF æ™‚å‡ºéŒ¯:', error);
        }
      }

      // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
      window.addEventListener('load', async () => {
        console.log('Loading animation preview loaded');
        // åˆå§‹é¡¯ç¤ºé€²åº¦
        updateProgress(0);
        // è¼‰å…¥éš¨æ©Ÿ GIF
        await loadRandomGif();
      });
    </script>
  </body>
</html>

