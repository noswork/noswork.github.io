var E=Object.defineProperty,I=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var C=(e,t,s)=>t in e?E(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,h=(e,t)=>{for(var s in t||(t={}))P.call(t,s)&&C(e,s,t[s]);if(T)for(var s of T(t))A.call(t,s)&&C(e,s,t[s]);return e},y=(e,t)=>I(e,j(t));var D=(e,t)=>{var s={};for(var a in e)P.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(e!=null&&T)for(var a of T(e))t.indexOf(a)<0&&A.call(e,a)&&(s[a]=e[a]);return s};import{r as d,j as m,R as b}from"./pb09dh9fam0wt6jz.js";import{dS as w,dT as k,dU as U,dV as x,dW as F,aR as q}from"./8i5ljbfelmyfiwtx.js";import{T as S}from"./ic6olz135s1xgisr.js";import{hw as G,aX as L,aQ as _,aR as Q,bq as V,oA as W}from"./bjx6p88nrzc4ug4u.js";function X(e){var g;const f=e,{bufferType:t,isActivelyStreaming:s,messages:a,parts:n}=f,i=D(f,["bufferType","isActivelyStreaming","messages","parts"]),o=a[a.length-1].id,[l,u]=d.useState(G(n)),r=d.useRef(void 0);if(r.current===void 0)switch(t){case"Adaptive":r.current=new U(n,u,s);break;case"ChunkedCatchup":r.current=new k(n,u,s);break;case"Punctuation":r.current=new w(n,u,s);break}return d.useEffect(()=>{r.current!=null&&(r.current.onMessagePartsUpdated(n,s),r.current.isBuffering()&&x.addDelayedRenderingMessage(o))},[n,o,s]),d.useEffect(()=>{r.current!=null&&r.current.removeDelayedRender()&&x.removeDelayedRenderingMessage(o)},[l,o]),d.useEffect(()=>()=>x.removeDelayedRenderingMessage(o),[o]),d.useEffect(()=>()=>{var c;(c=r.current)==null||c.destroy(),r.current=void 0},[]),m.jsx(S,y(h({},i),{messages:a,parts:n,displayParts:l,isActivelyStreaming:s||!!((g=r.current)!=null&&g.isBuffering())}))}function $({message:e,isCompletionInProgress:t,hasActiveRequest:s,clientThreadId:a,className:n,isUserTurn:i,isFinalUserTurn:o,isWithinFirstAssistantTurns:l,turnIndex:u,isFeedbackEnabled:r,prevGroupedMessageType:f,prevGroupedMessages:g,citableMessages:c,superWidgetImages:p}){var M,R,v;const B=d.useMemo(()=>"parts"in e.content?e.content.parts:[L(e)],[e]);return m.jsxs(m.Fragment,{children:[m.jsx(H,{parts:B,messages:[e],hasActiveRequest:s,isCompletionInProgress:t,className:n,citations:(M=e.metadata)==null?void 0:M.citations,contentReferences:(R=e.metadata)==null?void 0:R.content_references,attachments:(v=e.metadata)==null?void 0:v.attachments,isUserTurn:i,isFinalUserTurn:o,isWithinFirstAssistantTurns:l,turnIndex:u,id:e.id,isFeedbackEnabled:r,clientThreadId:a,prevGroupedMessageType:f,prevGroupedMessages:g,citableMessages:c,superWidgetImages:p}),!1]})}const Z=b.memo($),z=()=>null;function H(e){const t=z()!=null,s=e.messages.length>1,a=_.isLastActorMessage(Q(e.clientThreadId),e.messages[0].id),n=!!V(e.clientThreadId,c=>c==null?void 0:c.sharedConversationMetadata),i=s?void 0:F(e.messages[0],a,t,e.isCompletionInProgress||e.hasActiveRequest,n),o=(i==null?void 0:i.flagSeverity)!=="danger"&&e.isCompletionInProgress,l=!e.parts.some(c=>c!==""),{bufferType:u,wordFadeType:r}=q(),[f,g]=d.useState(()=>r!=="indexed"&&u!=="none"&&!e.isUserTurn&&(e.isCompletionInProgress||l&&!i));return i&&f&&g(!1),f?m.jsx(X,y(h({},e),{bufferType:u,isActivelyStreaming:o,errorState:i})):m.jsx(S,y(h({},e),{displayParts:W({isUserTurn:e.isUserTurn,parts:e.parts}),isActivelyStreaming:o,errorState:i}))}export{Z as T,H as a};
//# sourceMappingURL=jg92tkqirxcfjr1c.js.map
