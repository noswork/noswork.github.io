<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>游戏调试 - NOS MAZE</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        .status-box {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #ccc;
        }
        .status-box.success {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        .status-box.error {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        .test-canvas {
            border: 2px solid #333;
            margin: 10px 0;
            background: white;
        }
        button {
            background: #000;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #333;
        }
        pre {
            background: #1a1a1a;
            color: #10b981;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        h2 {
            margin-top: 30px;
        }
    </style>
    <script src="i18n.js?v=4"></script>
</head>
<body>
    <h1>🔍 NOS MAZE 调试工具</h1>
    
    <div id="status"></div>
    
    <h2>测试步骤</h2>
    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0;">
        <h3 style="margin-top: 0;">📱 手机端调试说明</h3>
        <p><strong>如果游戏Canvas空白，请点击下方"进入游戏(调试模式)"</strong></p>
        <p>调试模式会在屏幕底部显示绿色/红色的Console日志，可以看到具体哪里出错了。</p>
    </div>
    
    <button onclick="runTests()">运行所有测试</button>
    <button onclick="testCanvas()">测试Canvas</button>
    <button onclick="testTranslations()">测试翻译</button>
    <button onclick="setLanguage('zh')">设置中文</button>
    <button onclick="setLanguage('en')">设置英文</button>
    <button onclick="window.location.href='game.html?mode=just-maze&size=mini'">进入游戏</button>
    <button onclick="window.location.href='game.html?mode=just-maze&size=mini&debug=1'" style="background:#f00; color:#fff">进入游戏(调试模式)</button>
    
    <div id="testResults"></div>
    
    <h2>Canvas测试</h2>
    <canvas id="testCanvas" class="test-canvas" width="300" height="300"></canvas>
    
    <h2>系统信息</h2>
    <div id="systemInfo"></div>
    
    <script>
        const log = [];
        
        function addStatus(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status-box ${type}`;
            div.textContent = message;
            document.getElementById('status').appendChild(div);
            log.push(`[${type.toUpperCase()}] ${message}`);
        }
        
        function setLanguage(lang) {
            localStorage.setItem('maze-lang', lang);
            window.__MAZE_PRELOAD_LANG__ = lang;
            addStatus(`✅ 语言已设置为: ${lang === 'zh' ? '中文' : '英文'}`, 'success');
            addStatus('请刷新页面或重新运行测试', 'info');
            showSystemInfo();
        }
        
        function showSystemInfo() {
            const savedLang = localStorage.getItem('maze-lang');
            const preloadLang = window.__MAZE_PRELOAD_LANG__;
            
            const info = {
                'User Agent': navigator.userAgent,
                '屏幕尺寸': `${window.screen.width} x ${window.screen.height}`,
                '视口尺寸': `${window.innerWidth} x ${window.innerHeight}`,
                '设备像素比': window.devicePixelRatio,
                '触摸支持': 'ontouchstart' in window ? '是' : '否',
                'LocalStorage语言': savedLang || '未设置',
                '预加载语言': preloadLang || '未设置',
                'MAZE_TRANSLATIONS': typeof window.MAZE_TRANSLATIONS !== 'undefined' ? '已加载' : '未加载'
            };
            
            let html = '<pre>';
            for (const [key, value] of Object.entries(info)) {
                html += `${key}: ${value}\n`;
            }
            html += '</pre>';
            
            document.getElementById('systemInfo').innerHTML = html;
        }
        
        function testCanvas() {
            addStatus('开始测试Canvas...', 'info');
            
            const canvas = document.getElementById('testCanvas');
            if (!canvas) {
                addStatus('❌ Canvas元素未找到', 'error');
                return;
            }
            
            addStatus('✅ Canvas元素已找到', 'success');
            
            const ctx = canvas.getContext('2d');
            if (!ctx) {
                addStatus('❌ 无法获取2D上下文', 'error');
                return;
            }
            
            addStatus('✅ 2D上下文获取成功', 'success');
            
            // 绘制测试图案
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, 300, 300);
            
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 2;
            
            // 绘制网格
            for (let i = 0; i <= 300; i += 30) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, 300);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(300, i);
                ctx.stroke();
            }
            
            // 绘制圆点
            ctx.fillStyle = '#10b981';
            ctx.beginPath();
            ctx.arc(50, 50, 10, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = '#ef4444';
            ctx.beginPath();
            ctx.arc(250, 250, 10, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = '#3b82f6';
            ctx.beginPath();
            ctx.arc(150, 150, 15, 0, Math.PI * 2);
            ctx.fill();
            
            addStatus('✅ Canvas绘制测试完成', 'success');
        }
        
        function testTranslations() {
            addStatus('开始测试翻译系统...', 'info');
            
            if (typeof window.MAZE_TRANSLATIONS === 'undefined') {
                addStatus('❌ MAZE_TRANSLATIONS未定义', 'error');
                return;
            }
            
            addStatus('✅ MAZE_TRANSLATIONS已加载', 'success');
            
            if (typeof window.getMazeTranslation !== 'function') {
                addStatus('❌ getMazeTranslation函数未定义', 'error');
                return;
            }
            
            addStatus('✅ getMazeTranslation函数已定义', 'success');
            
            // 测试翻译
            const testKey = 'game.steps';
            const zhTranslation = window.getMazeTranslation('zh', testKey);
            const enTranslation = window.getMazeTranslation('en', testKey);
            
            addStatus(`中文翻译: "${testKey}" = "${zhTranslation}"`, zhTranslation !== testKey ? 'success' : 'error');
            addStatus(`英文翻译: "${testKey}" = "${enTranslation}"`, enTranslation !== testKey ? 'success' : 'error');
            
            // 检查预加载语言和LocalStorage
            const preloadLang = window.__MAZE_PRELOAD_LANG__;
            const storedLang = localStorage.getItem('maze-lang');
            
            addStatus(`LocalStorage语言: ${storedLang || '未设置'}`, storedLang ? 'success' : 'error');
            addStatus(`预加载语言: ${preloadLang || '未设置'}`, preloadLang ? 'success' : 'error');
            
            if (!storedLang) {
                addStatus('⚠️ 语言未设置，点击上方按钮设置语言', 'error');
            }
        }
        
        function runTests() {
            document.getElementById('status').innerHTML = '';
            log.length = 0;
            
            addStatus('🚀 开始运行测试...', 'info');
            
            testTranslations();
            testCanvas();
            showSystemInfo();
            
            addStatus('✅ 所有测试完成', 'success');
            
            // 显示日志
            const logDiv = document.createElement('div');
            logDiv.innerHTML = '<h2>测试日志</h2><pre>' + log.join('\n') + '</pre>';
            document.getElementById('testResults').innerHTML = logDiv.outerHTML;
        }
        
        // 页面加载时运行测试
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(runTests, 100);
        });
    </script>
</body>
</html>

