<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NOS MAZE - Game (Debug)</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css">
    <style>
        #debug-info {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: #0f0;
            padding: 20px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 12px;
            z-index: 999999;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
        }
        #debug-info h3 {
            color: #ff0;
            margin-top: 0;
        }
        #debug-info .error {
            color: #f00;
        }
        #debug-info .success {
            color: #0f0;
        }
        #debug-info .info {
            color: #0ff;
        }
    </style>
    <script>
        // 诊断脚本
        window.addEventListener('DOMContentLoaded', () => {
            const info = [];
            
            info.push('<h3>🔍 诊断信息</h3>');
            
            // 1. 检查翻译系统
            info.push('<div class="info">--- 翻译系统 ---</div>');
            if (typeof window.MAZE_TRANSLATIONS !== 'undefined') {
                info.push('<div class="success">✅ MAZE_TRANSLATIONS 已加载</div>');
                info.push('<div class="info">翻译数量: ' + Object.keys(window.MAZE_TRANSLATIONS.zh || {}).length + '</div>');
                
                // 测试翻译
                if (window.getMazeTranslation) {
                    const testKey = 'game.steps';
                    const zhTest = window.getMazeTranslation('zh', testKey);
                    const enTest = window.getMazeTranslation('en', testKey);
                    info.push('<div class="' + (zhTest !== testKey ? 'success' : 'error') + '">中文: "' + testKey + '" = "' + zhTest + '"</div>');
                    info.push('<div class="' + (enTest !== testKey ? 'success' : 'error') + '">英文: "' + testKey + '" = "' + enTest + '"</div>');
                } else {
                    info.push('<div class="error">❌ getMazeTranslation 函数不存在</div>');
                }
            } else {
                info.push('<div class="error">❌ MAZE_TRANSLATIONS 未加载</div>');
            }
            
            // 2. 检查Canvas
            info.push('<div class="info">--- Canvas ---</div>');
            const canvas = document.getElementById('gameCanvas');
            if (canvas) {
                info.push('<div class="success">✅ Canvas 元素存在</div>');
                info.push('<div class="info">尺寸: ' + canvas.width + 'x' + canvas.height + '</div>');
                
                const ctx = canvas.getContext('2d');
                if (ctx) {
                    info.push('<div class="success">✅ 2D 上下文已获取</div>');
                } else {
                    info.push('<div class="error">❌ 无法获取 2D 上下文</div>');
                }
            } else {
                info.push('<div class="error">❌ Canvas 元素不存在</div>');
            }
            
            // 3. 系统信息
            info.push('<div class="info">--- 系统信息 ---</div>');
            info.push('<div class="info">User Agent: ' + navigator.userAgent.substring(0, 50) + '...</div>');
            info.push('<div class="info">视口: ' + window.innerWidth + 'x' + window.innerHeight + '</div>');
            info.push('<div class="info">LocalStorage语言: ' + (localStorage.getItem('maze-lang') || '未设置') + '</div>');
            info.push('<div class="info">预加载语言: ' + (window.__MAZE_PRELOAD_LANG__ || '未设置') + '</div>');
            
            // 4. 检查游戏参数
            info.push('<div class="info">--- URL 参数 ---</div>');
            const params = new URLSearchParams(window.location.search);
            info.push('<div class="info">mode: ' + (params.get('mode') || '未设置') + '</div>');
            info.push('<div class="info">size: ' + (params.get('size') || '未设置') + '</div>');
            
            // 5. 显示诊断信息
            const debugDiv = document.createElement('div');
            debugDiv.id = 'debug-info';
            debugDiv.innerHTML = info.join('') + '<div style="margin-top:20px;text-align:center;"><button onclick="this.parentElement.parentElement.remove()" style="background:#f00;color:#fff;border:none;padding:10px 20px;border-radius:5px;cursor:pointer;">关闭诊断</button></div>';
            document.body.appendChild(debugDiv);
            
            // 等待3秒后尝试初始化游戏
            setTimeout(() => {
                if (typeof window.mazeGame === 'undefined') {
                    const extraInfo = document.createElement('div');
                    extraInfo.className = 'error';
                    extraInfo.innerHTML = '<br>❌ 游戏未初始化！检查Console是否有错误。';
                    debugDiv.insertBefore(extraInfo, debugDiv.lastChild);
                }
            }, 3000);
        });
    </script>
    <!-- 預加載主題和語言 -->
    <script>
        (function() {
            const savedTheme = localStorage.getItem('maze-theme') || 'light';
            const savedLang = localStorage.getItem('maze-lang') || 'zh';
            
            let actualTheme = savedTheme;
            if (savedTheme === 'system') {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                actualTheme = prefersDark ? 'dark' : 'light';
            }
            
            document.documentElement.className = 'theme-' + actualTheme;
            document.documentElement.lang = savedLang === 'zh' ? 'zh-TW' : 'en';
            window.__MAZE_PRELOAD_LANG__ = savedLang;
        })();
    </script>
    <script src="i18n.js?v=7"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
    <script src="supabase-config.js?v=7" defer></script>
    <script src="supabase-client.js?v=7" defer></script>
    <script type="module" src="scripts/game/index.js?v=7"></script>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <div class="game-header-left">
                <button class="header-nav-btn" id="backBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                    <span data-i18n="game.back">返回選單</span>
                </button>
            </div>
            <div class="game-info">
                <div id="stepCounter">
                    <span data-i18n="game.steps">步数</span>: <span id="stepCount">0</span>
                </div>
                <div id="timer" style="display: none;">
                    <span data-i18n="game.time">时间</span>: <span id="timeDisplay">0:00</span>
                </div>
                <div id="mazeCounter" style="display: none;">
                    <span data-i18n="game.mazes">迷宫</span>: <span id="mazeCount">0</span>
                </div>
            </div>
            <div class="game-header-right">
                <button class="pause-btn" id="pauseBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="pause-icon">
                        <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
                    </svg>
                </button>
            </div>
        </div>
        
        <div class="canvas-wrapper">
            <canvas id="gameCanvas"></canvas>
        </div>
        
        <div class="game-status" id="gameStatus"></div>
        
        <div class="dpad-container" id="dpadContainer">
            <button class="dpad-btn dpad-up" id="dpadUp" aria-label="Up">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M7 14l5-5 5 5z"/>
                </svg>
            </button>
            <div class="dpad-bottom-row">
                <button class="dpad-btn dpad-left" id="dpadLeft" aria-label="Left">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M14 7l-5 5 5 5z"/>
                    </svg>
                </button>
                <button class="dpad-btn dpad-down" id="dpadDown" aria-label="Down">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M7 10l5 5 5-5z"/>
                    </svg>
                </button>
                <button class="dpad-btn dpad-right" id="dpadRight" aria-label="Right">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M10 17l5-5-5-5z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>
</body>
</html>

