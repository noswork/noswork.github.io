const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/i5eo8pfkzgbhih3o.js","assets/bjx6p88nrzc4ug4u.js","assets/pb09dh9fam0wt6jz.js","assets/root-bozb8ycf.css","assets/8i5ljbfelmyfiwtx.js","assets/conversation-small-gdrsfoe1.css","assets/k0lrzfg5vi5tl9he.js","assets/bh8xd322is3c88a6.js","assets/e1gi3ueoqn4ujcn0.js","assets/nni6i0g76t9sff5b.js","assets/k001n68kyondvhdx.js","assets/h5zerio080s2aqj6.js","assets/k4gjsni4agy8nw73.js","assets/rrie3xck3ez5i2ht.js","assets/2cs8wb47gdpolnf5.js","assets/d3pgclo0m1f0f95c.js"])))=>i.map(i=>d[i]);
var Vt=Object.freeze,Ht=Object.defineProperty,Ya=Object.defineProperties;var Ja=Object.getOwnPropertyDescriptors;var Je=Object.getOwnPropertySymbols;var Bt=Object.prototype.hasOwnProperty,Lt=Object.prototype.propertyIsEnumerable;var Ot=(a,t,o)=>t in a?Ht(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o,G=(a,t)=>{for(var o in t||(t={}))Bt.call(t,o)&&Ot(a,o,t[o]);if(Je)for(var o of Je(t))Lt.call(t,o)&&Ot(a,o,t[o]);return a},le=(a,t)=>Ya(a,Ja(t));var Wt=(a,t)=>{var o={};for(var e in a)Bt.call(a,e)&&t.indexOf(e)<0&&(o[e]=a[e]);if(a!=null&&Je)for(var e of Je(a))t.indexOf(e)<0&&Lt.call(a,e)&&(o[e]=a[e]);return o};var Ze=(a,t)=>Vt(Ht(a,"raw",{value:Vt(t||a.slice())}));import{r as d,j as s,M as Q,d as In,R as Za,i as eo,A as so}from"./pb09dh9fam0wt6jz.js";import{d_ as De,d$ as Ue,F as Cs,aR as ns,eB as y,aQ as F,bo as W,e as X,_ as to,n9 as no,bq as Ee,aU as ue,aY as Es,aS as Pe,j7 as ao,bh as Sn,B as Tn,i2 as yn,R as oo,A as io,c2 as qt,au as $t,i as Ge,aO as zt,b as ro,X as wn,gO as lo,Z as Cn,Y as En,oj as co,d as uo,h as mo,mn as Is,i6 as go,ft as ho,aW as po,j as Ie,a3 as Fe,ax as fo,fS as bo,ky as xo,br as vo,b5 as _o,g3 as Io,mX as So,mS as To,mY as yo,n8 as wo,aN as os,aM as es,bn as Co,q as Eo,ab as ko,P as Ss,t as Mo,ow as Ao,fv as Ro,po as jo,ad as Fo,kN as Po,aX as ts,pp as ks,mV as Kt,cJ as No,mW as Do,cn as Uo,co as Go,dO as Vo,cB as Qt,k7 as ss,bm as Xt,gP as as,hG as Oo,jN as Ho,mi as Bo,pq as Lo,a2 as Wo,bR as qo,az as $o}from"./bjx6p88nrzc4ug4u.js";import{hw as zo,cW as kn,hx as Yt,bU as Ko,hy as Jt,hz as Qo,hA as Mn,hB as Zt,hC as Xo,hD as Yo,br as Jo,bs as Zo,hE as ei,hF as si,hG as ti,Y as ni,k as ai,hH as oi,gt as ii,hI as en,hJ as ri,cT as sn,hK as li,ay as ci,hL as di,aw as ui,hM as mi,hN as gi,hO as tn,hP as hi,aC as nn,hQ as pi,hR as fi,hS as bi,hT as xi,hU as vi,hV as _i,hW as Ii,hX as Si,hY as Ti,hZ as yi,h_ as wi,h$ as Ci,i0 as Ei,i1 as ki,i2 as An,i3 as Mi,i4 as Ai,i5 as Ri,i6 as ji,i7 as Fi,i8 as Pi,i9 as Ni,ia as Di,ib as Ui,ic as Gi,id as Vi,ie as an,ig as Oi,ih as Hi,ii as Bi,ij as Li,ik as Wi,il as qi,im as $i,io as zi,ip as Ki,iq as Qi,ir as Xi,is as Yi,it as Ji,aB as on,iu as Zi,iv as er,iw as sr,ix as Ne,iy as Rn,iz as tr,iA as jn,iB as Fn,iC as Pn,iD as nr,iE as ar,iF as or,iG as ir,iH as rr,iI as lr}from"./8i5ljbfelmyfiwtx.js";import{C as ys}from"./k2i06rd8syuzz099.js";const rn=De(()=>Ue(()=>import("./i5eo8pfkzgbhih3o.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(a=>a.MemoryActionResult));function ln(a,t,o){ue(a,e=>{Es.updateTree(e,i=>{i.updateNodeMetadata(t,{inlineComparisonRating:o})})})}const cn=({messages:a})=>{for(const{metadata:t}of a){const{paragen_display_label:o}=t!=null?t:{};if(o)return o;const{augmented_paragen_prompt_label:e}=t!=null?t:{};if(e)return e}};function cr(a){const t=d.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),o=d.useRef({left:null,right:null});return a.variantIds.length<2?s.jsx(Nn,G({setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:t,firstVisibleTokenTimestampsRef:o},a)):s.jsx(dr,le(G({},a),{visibilityStateRef:t,firstVisibleTokenTimestampsRef:o}))}function dr(a){const{clientThreadId:t,variantIds:o,turnIndex:e,firstVisibleTokenTimestampsRef:i}=a;if(o.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const p=Mn(),g=to(),[f,m]=o,c=d.useMemo(()=>no(f+m)()>=.5,[f,m]),[E,x]=c?[m,f]:[f,m],[M,A,T]=Ee(t,h=>{var r,q,I,H,B,u,$,ne,S,me,ge,z,oe,D,ie,ce,L,de,he,Ve;const R=qt(h).tree.getLeafFromNode(E).id,C=qt(h).tree.getLeafFromNode(x).id,v=F.getConversationTurns(h,R),w=F.getConversationTurns(h,C),V=e<v.length?v[e]:null,O=e<w.length?w[e]:null;return V||$t.addError("Paragen Left turn index ".concat(e," out of bounds"),{turnIndex:e,turnCount:v.length,lastTurnRole:(r=y(v))==null?void 0:r.role,lastMessageAuthor:(I=y((q=y(v))==null?void 0:q.messages))==null?void 0:I.author,lastMessageContentType:(B=y((H=y(v))==null?void 0:H.messages))==null?void 0:B.content.content_type,lastMessageMetadata:($=y((u=y(v))==null?void 0:u.messages))==null?void 0:$.metadata,altTurnCount:w.length,altLastTurnRole:(ne=y(w))==null?void 0:ne.role,altLastMessageRole:(me=y((S=y(w))==null?void 0:S.messages))==null?void 0:me.author.role}),O||$t.addError("Paragen Right turn index ".concat(e," out of bounds"),{turnIndex:e,turnCount:w.length,lastTurnRole:(ge=y(w))==null?void 0:ge.role,lastMessageAuthor:(oe=y((z=y(w))==null?void 0:z.messages))==null?void 0:oe.author,lastMessageContentType:(ie=y((D=y(w))==null?void 0:D.messages))==null?void 0:ie.content.content_type,lastMessageMetadata:(L=y((ce=y(w))==null?void 0:ce.messages))==null?void 0:L.metadata,altTurnCount:v.length,altLastTurnRole:(de=y(v))==null?void 0:de.role,altLastMessageRole:(Ve=y((he=y(v))==null?void 0:he.messages))==null?void 0:Ve.author.role}),[R,V,O]}),[P,N]=c?[T,A]:[A,T],Y="skippable_parallel_2_in_stream:a:1.5";d.useEffect(()=>(Zt.setState({displayingSideBySideFeedback:!0}),()=>{Zt.setState({displayingSideBySideFeedback:!1})}),[]);const J=d.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),te=d.useCallback((h,{shouldSubmitParagenFeedback:R=!0}={})=>{var H,B;if(!A||!T||!P||!N)throw new Error("Expected both turns to exist");ue(t,u=>{Es.setCurrentBranch(u,h)});const C=h===E,v=h===f;P.messages.length>0&&ln(t,P.messages[P.messages.length-1].id,v?"original":"new"),N.messages.length>0&&ln(t,N.messages[N.messages.length-1].id,v?"original":"new");const w=Pe(t),V=[A,T].map((u,$)=>{var ne,S;return{messageId:u.messages[u.messages.length-1].id,loadFirstTokenTime:$===0?i.current.left:i.current.right,loadEndTime:(S=(ne=y(u.messages))==null?void 0:ne.clientMetadata)==null?void 0:S.completionSampleFinishTime}}),O=C?V[0].messageId:V[1].messageId,r=F.getParentPromptNode(ns(t),M);if(!r)throw new Error("Expected prompt for side by side feedback");const q={},I=((H=r.message.clientMetadata)==null?void 0:H.variantsInStreamInfo)==null&&((B=r.message.metadata)==null?void 0:B.paragen_variants_info)!=null;for(const u of V)q[u.messageId]=I?{load_first_token_time:a.conversationTurnMountTime,load_end_time:a.conversationTurnMountTime}:{load_first_token_time:u.loadFirstTokenTime,load_end_time:u.loadEndTime};R&&hn({params:{conversation_id:w,displayed_message_ids:V.map(u=>u.messageId),message_metadatas:q,rating:"selected",selected_message_id:O,source_timestamp:Date.now(),ui_variant:1,user_prompt_message_id:r.message.id}})},[t,E,f,P,N,A,T,M,i,a.conversationTurnMountTime]);return d.useEffect(()=>ao(Sn,{requestCompletion:h=>{var r,q;const R=Pe(t),C=F.getParentPromptNode(ns(t),M);if(!C)throw new Error("Expected prompt for side by side feedback");if(!A||!T)throw new Error("Expected both turns to exist");const v=[A,T].map((I,H)=>{var B,u;return{messageId:I.messages[I.messages.length-1].id,loadFirstTokenTime:H===0?i.current.left:i.current.right,loadEndTime:(u=(B=y(I.messages))==null?void 0:B.clientMetadata)==null?void 0:u.completionSampleFinishTime}}),w={},V=((r=C.message.clientMetadata)==null?void 0:r.variantsInStreamInfo)==null&&((q=C.message.metadata)==null?void 0:q.paragen_variants_info)!=null;for(const I of v)w[I.messageId]=V?{load_first_token_time:a.conversationTurnMountTime,load_end_time:a.conversationTurnMountTime}:{load_first_token_time:I.loadFirstTokenTime,load_end_time:I.loadEndTime};const O=h.isForSkippingParagen;hn({params:{conversation_id:R,displayed_message_ids:v.map(I=>I.messageId),message_metadatas:w,rating:O?"explicit_skipped":"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:O?3:1,user_prompt_message_id:C.message.id}}),O&&te(E,{shouldSubmitParagenFeedback:!1})}}),[A,T,M,t,a.conversationTurnMountTime,Y,P==null?void 0:P.messages,N==null?void 0:N.messages,g,i,te,E]),s.jsx(Nn,le(G({},a),{setPreferredFeedback:te,leftVariantId:E,rightVariantId:x,leftTurn:A,rightTurn:T,hasActiveRequest:p,originalTurn:P,visibilityStateRef:J}))}function Nn(c){var E=c,{setPreferredFeedback:a,leftVariantId:t,rightVariantId:o,leftTurn:e,rightTurn:i,hasActiveRequest:p,originalTurn:g,visibilityStateRef:f}=E,m=Wt(E,["setPreferredFeedback","leftVariantId","rightVariantId","leftTurn","rightTurn","hasActiveRequest","originalTurn","visibilityStateRef"]);var ge,z,oe;const x=(ge=e&&cn(e))!=null?ge:null,M=(z=i&&cn(i))!=null?z:null,A=d.useMemo(()=>{var D;return(D=e==null?void 0:e.messages)!=null?D:[]},[e==null?void 0:e.messages]),T=d.useMemo(()=>{var D;return(D=i==null?void 0:i.messages)!=null?D:[]},[i==null?void 0:i.messages]),{avatarClassName:P,firstVisibleTokenTimestampsRef:N}=m,Y=d.useMemo(()=>{var D;return(D=e==null?void 0:e.messageGroups)!=null?D:[]},[e==null?void 0:e.messageGroups]),J=d.useMemo(()=>{var D;return(D=i==null?void 0:i.messageGroups)!=null?D:[]},[i==null?void 0:i.messageGroups]),te=zo(),h=ns(m.clientThreadId),R=y(e==null?void 0:e.messages),C=y(i==null?void 0:i.messages),v=kn(F.getRequestId(h,(oe=R==null?void 0:R.id)!=null?oe:C==null?void 0:C.id)),w=v&&!(R!=null&&R.end_turn),V=v&&!(C!=null&&C.end_turn),O=R!=null&&Yt(R),r=C!=null&&Yt(C),q=O!=null?O:r,I=(e==null?void 0:e.role)===W.User,H=(i==null?void 0:i.role)===W.User,B=d.useRef(null),u=d.useRef(null),$=d.useRef(null),ne=e!=null,S=i!=null;!ne&&N.current.left==null&&(N.current.left=Date.now()),!S&&N.current.right==null&&(N.current.right=Date.now()),d.useEffect(()=>{if(B.current&&u.current&&$.current){const D=Array(11).fill(0).map((ce,L)=>L/10),ie=new IntersectionObserver(ce=>ce.forEach(L=>{var de,he;L.target===u.current?(f.current.left_visibility_initial==null&&(f.current.left_visibility_initial=L.intersectionRatio),f.current.left_visibility_max=Math.max((de=f.current.left_visibility_max)!=null?de:0,L.intersectionRatio)):L.target===$.current&&(f.current.right_visibility_initial==null&&(f.current.right_visibility_initial=L.intersectionRatio),f.current.right_visibility_max=Math.max((he=f.current.right_visibility_max)!=null?he:0,L.intersectionRatio))}),{root:B.current,threshold:D});return ie.observe(u.current),ie.observe($.current),()=>ie.disconnect()}},[f]);const{data:me}=Ko(void 0,!1,te);return s.jsxs("div",{className:"relative flex flex-col",children:[s.jsx("div",{className:"bg-token-main-surface-primary sticky top-[-1px] z-1 px-(--thread-content-margin) text-center text-lg text-pretty md:static","data-testid":"paragen-feedback-title",children:s.jsx(Q,{id:"KKeSJV",defaultMessage:"You're giving feedback on a new version of ChatGPT."})}),s.jsx("div",{className:"text-token-text-secondary px-(--thread-content-margin) pt-1 pb-5 text-center text-sm text-pretty",children:s.jsx(Q,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),s.jsx("div",{className:X(Qo("default"),"horzScrollShadows relative -mb-2 snap-x snap-mandatory overflow-x-auto overflow-y-clip pb-4"),ref:B,children:s.jsxs("div",{className:X("mx-auto box-content max-w-[calc(2*var(--thread-content-max-width))] min-w-min px-(--thread-content-margin)","flex items-start gap-4 sm:gap-6"),children:[s.jsxs(dn,{rootElementRef:u,onClick:()=>{a(t)},hasActiveRequest:p,isImageGenInProgress:q,children:[s.jsxs(mn,{children:[s.jsx(Jt,{messages:A,isUserTurn:I,avatarClassName:P}),s.jsx(un,{children:s.jsx(Q,le(G({},pn.responseNumber),{values:{responseIndex:1,display_label:x?" ".concat(x):""}}))})]}),s.jsxs(s.Fragment,{children:[me!=null&&!I&&s.jsx(rn,{clientThreadId:m.clientThreadId,messages:A,isParagen:!0}),s.jsx(ys,le(G({},m),{allMessages:A,groupedMessagesToRender:Y,allGroupedMessages:Y,isUserTurn:I,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isCompletionRequestInProgress:w,hasActiveRequest:p,shouldGrowContainer:!1,isParagen:!0})),s.jsx(gn,{clientThreadId:m.clientThreadId,conversationTurnMountTime:m.conversationTurnMountTime,turn:e,originalTurn:g})]})]}),s.jsxs(dn,{rootElementRef:$,onClick:()=>{a(o)},hasActiveRequest:p,isImageGenInProgress:q,children:[s.jsxs(mn,{children:[s.jsx(Jt,{messages:T,isUserTurn:H,avatarClassName:P}),s.jsx(un,{children:s.jsx(Q,le(G({},pn.responseNumber),{values:{responseIndex:2,display_label:M?" ".concat(M):""}}))})]}),s.jsxs(s.Fragment,{children:[me!=null&&!H&&s.jsx(rn,{clientThreadId:m.clientThreadId,messages:T,isParagen:!0}),s.jsx(ys,le(G({},m),{allMessages:T,groupedMessagesToRender:J,allGroupedMessages:J,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isUserTurn:H,isCompletionRequestInProgress:V,hasActiveRequest:p,shouldGrowContainer:!1,isParagen:!0})),s.jsx(gn,{clientThreadId:m.clientThreadId,conversationTurnMountTime:m.conversationTurnMountTime,turn:i,originalTurn:g})]})]})]})})]})}function dn({rootElementRef:a,onClick:t,children:o,hasActiveRequest:e,isImageGenInProgress:i}){const p=d.useRef(null),g=d.useRef(null),f=d.useRef(null);return s.jsx("div",{"data-paragen-root":!0,className:"border-token-border-tertiary @container relative flex min-w-[min(450px,80cqw,80vw)] flex-1 snap-center flex-col gap-1 rounded-xl border text-start shadow-lg shadow-black/3",ref:a,children:s.jsxs("div",{className:X(Xo,"px-(--thread-content-margin) py-4"),children:[s.jsx("div",{className:X("absolute top-48 right-0! left-0! h-px","invisible"),ref:p}),s.jsx("div",{className:X("absolute top-48 right-0! bottom-0 left-0!","invisible"),ref:g}),s.jsx("div",{className:X("absolute right-0! bottom-0 left-0! h-px","invisible"),ref:f}),o,e||i?null:s.jsx(Tn,{className:"mt-4 self-start",onClick:t,"data-testid":"paragen-prefer-response-button",children:s.jsx(Q,{id:"U2EAH6",defaultMessage:"I prefer this response"})})]})})}var xn;const un=Cs.div(xn||(xn=Ze(["text-sm text-token-text-secondary font-semibold"])));var vn;const mn=Cs.div(vn||(vn=Ze(["flex gap-4 items-center mb-1"])));function gn({clientThreadId:a,conversationTurnMountTime:t,turn:o,originalTurn:e}){var x,M,A,T,P,N;const i=yn();if(!i.showParagenMetadata||!i.showDebugConversationTurns&&!i.forceParagen||o==null)return null;let p=o===e?"ORIGINAL":"NEW";const g=o.messages[o.messages.length-1],f=(x=g==null?void 0:g.metadata)==null?void 0:x.__internal,m=(M=g==null?void 0:g.metadata)==null?void 0:M.paragen_display_label;if(f){const{model_id:Y,model_definition_slug:J,model_definition_virtual_model_id:te,alternative_model_selection_rule:h,augmented_paragen_prompt_group_id:R,augmented_paragen_prompt_id:C,augmented_paragen_prompt:v}=f;Y&&(p+="\nModel ID: ".concat(Y)),J&&(p+="\nModel Slug: ".concat(J)),te&&(p+="\nVirtual Model ID: ".concat(te)),h&&(p+="\nAlternative Model Rule: ".concat(h)),R&&(p+="\nPrompt Group ID: ".concat(R)),C&&(p+="\nPrompt ID: ".concat(C)),v&&(p+="\nPrompt: ".concat(v)),m&&(p+="\nDisplay Label: ".concat(m))}p+="\nMessage ID: ".concat(g.id);const c=F.getParentPromptNode(ns(a),o.messages[0].id);if(!c)throw new Error("Expected prompt for side by side feedback");const E=((A=c.message.clientMetadata)==null?void 0:A.variantsInStreamInfo)==null&&((T=c.message.metadata)==null?void 0:T.paragen_variants_info)!=null;return p+="\nUser prompt message ID: ".concat(c.message.id),p+="\nIs Persisted Paragen? ".concat(E),p+="\nCompletion Sample Finish Time: ".concat(E?"".concat(t," (persisted)"):(N=(P=y(o.messages))==null?void 0:P.clientMetadata)==null?void 0:N.completionSampleFinishTime),s.jsx("div",{className:"text-sm whitespace-pre-wrap text-red-500",children:p})}async function hn({params:a}){await oo.safePost("/paragen_submission",{requestBody:a,authOption:io.SendIfAvailable})}const pn=In({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}{display_label}"}}),ur=De(()=>Ue(()=>import("./i5eo8pfkzgbhih3o.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(a=>a.MemoryActionResult)),mr=De(()=>Ue(()=>import("./nni6i0g76t9sff5b.js"),__vite__mapDeps([9,2,1,3,10,4,5,11])).then(a=>a.AutomationSourceHeader)),fn=De(()=>Ue(()=>import("./k4gjsni4agy8nw73.js"),__vite__mapDeps([12,2,1,3,4,5,13])).then(a=>a.TextMessageEditor)),gr=De(()=>Ue(()=>import("./2cs8wb47gdpolnf5.js"),__vite__mapDeps([14,2,1,3,4,5,15])).then(a=>a.ChatScreenRetrievalResultsFlyoutContent)),bn=80,Ts=16;function ws(){return{minHeight:"calc(100dvh - ".concat(Ji,"px - 120px)")}}function hr(a){"use forget";var at,ot,it,rt,lt,ct,dt,ut,mt,gt,ht,pt,ft,bt,xt,vt,_t,It,St,Tt,yt,wt,Ct,Et,kt,Mt,At,Rt,jt;const{turnIndex:t,isFinalTurn:o,clientThreadId:e,onRequestCompletion:i,currentModelId:p,scrollToMessageId:g,dateHeaderType:f,hideUserActions:m}=a,c=Ge(),E=zt(c,e),x=Yo(c),M=ro(),[A,T,P]=wn(n=>[lo(n),Cn(n),En(n)]),N=!!M&&co(M),Y=uo(mo.isBusinessWorkspace),J=Yi(),{eligible:te}=Jo(Zo.hasSeenAudioParagenPrompt),[h,R,C]=Ee(e,n=>{const l=F.getConversationTurnAtIndex(n,t),b=t>0?F.getConversationTurnAtIndex(n,t-1):null,_=(b==null?void 0:b.role)===W.User&&b.messages.some(U=>{var K;return(K=U.metadata)==null?void 0:K.visually_hide_response_from_conversation});return[l,_,b]},{disablePerfDetector:o}),{messages:v,messageGroups:w}=h,V=ei(n=>n.size===0?-1:w.findIndex(l=>l.type===Is?l.groups.some(b=>b.messages.some(_=>n.has(_==null?void 0:_.id))):l.messages.some(b=>n.has(b==null?void 0:b.id)))),O=v[0],r=y(v),q=d.useMemo(()=>w.some(n=>n.type===go.SearchGPTQuery),[w]),I=d.useMemo(()=>v.some(n=>{var l;return(l=n.metadata)==null?void 0:l.n7jupd_message}),[v]),H=d.useMemo(()=>I?ho(v,n=>n.author.name==="n7jupd.metadata"):null,[v,I]),B=!!((at=H==null?void 0:H.metadata)!=null&&at.kaur1br5_mode),{messages:u,visibleMessages:$,messageGroups:ne,lastMessageToRender:S}=d.useMemo(()=>{const n=V!==-1&&V+1<w.length,l=n?w.slice(0,V+1):w,b=n?l.flatMap(_=>_.type===Is?_.groups.flatMap(U=>U.messages):_.messages):v;return{messages:b,visibleMessages:b.filter(po),messageGroups:l,lastMessageToRender:y(b)}},[v,w,V]),me=V!==-1,ge=Ie(c,"1887864177"),z=Ee(e,n=>F.getLastMessageSystemHints(n)),oe=(z==null?void 0:z.includes(Fe.Tatertot))&&Ie(c,"28816792")&&fo(c),{capabilitySuggestionsEnabled:D}=si(oe),ie=d.useMemo(()=>({clientThreadId:e,turnIndex:t,messageId:r==null?void 0:r.id}),[e,t,r==null?void 0:r.id]),[ce,L]=d.useState(!1),[de,he]=d.useState(!1),Ve=d.useContext(ti)!=null,j=h.role===W.User,is=bo(),pe=xo(e),rs=(ot=h.gizmoId)!=null?ot:pe,fe=vo(rs).data,ls=rs&&!_o(rs)?fe:void 0,Un=ls&&h.gizmoId!=null&&h.gizmoId!==pe&&Ie(c,"1418300125"),cs=Io(e),Gn=So(e),Oe=To(cs),Vn=yo(cs,Gn),ds=wo(),[be,On,Hn,Ms,us,Bn,He,Ln,Wn,As,ms,re,Be,Le,qn,Se,k]=Ee(e,n=>{var Ft,Pt,Nt,Dt;const l=F.getParentPromptNode(n,O.id),b=(Dt=(Ft=l==null?void 0:l.message.clientMetadata)==null?void 0:Ft.variantsInStreamInfo)!=null?Dt:(Pt=l==null?void 0:l.message.metadata)!=null&&Pt.paragen_variant_choice||(Nt=l==null?void 0:l.message.metadata)==null?void 0:Nt.paragen_variants_info,_=F.getVariantIds(n,O.id),U=F.getCurrentVariantId(n,O.id),K=U?_.indexOf(U):0,_e=b&&(n==null?void 0:n.tree)!=null&&_.some(se=>{var Gt;const{errType:Ut}=(Gt=n.tree.getLeafFromNode(se).message.clientMetadata)!=null?Gt:{};return Ut!=null&&Ut!=="info"}),ee=F.getConversationTurns(n),Re=ee.findIndex(se=>se.role===W.Assistant),Qa=on(ee,se=>se.role===W.Assistant),Xa=ee.slice(Re,t+1).every(se=>se.role===W.Assistant);return[l,r!=null&&!Lo(r.id)&&F.isMessageTurnEnded(n,r.id),_e,Zi(n==null?void 0:n.mode,fe==null?void 0:fe.gizmo.id),ee.findIndex(se=>se.role===W.User)===t,on(ee,se=>se.role===W.User)===t,Re===t,Qa===t,Xa,F.getRequestId(n,r==null?void 0:r.id),b,_,K,!!(n!=null&&n.continuingFromSharedPostId),n==null?void 0:n.currentLeafId,F.getSuperWidgetMessages(n,t)[0],F.lastUserMessage(n)]},{disablePerfDetector:o}),We=ni(),qe=os(()=>{const n=ai(E);return(n==null?void 0:n.value)===es.STREAMING||(n==null?void 0:n.value)===es.REALTIME}),$n=u.some(n=>n.content.content_type===Co.MultimodalText),zn=Eo(c,"3119715334").get("should-enable-skip",!1),{isUnauthenticated:Rs}=ko(),js=h.messages.map(n=>n.id),Z=d.useRef(null);pr({clientThreadId:e,turn:h,turnIndex:t,conversationTurnWrapperRef:Z});const Fs=!x&&((it=g==null?void 0:g.length)!=null?it:0)>2&&g!=="finalAgentTurn"&&o&&J,Te=j?y($):void 0,gs=Te==null?void 0:Te.id,Kn=d.useCallback(()=>{gs&&(Ss.logEvent("Edit Prompt",{id:gs,threadId:Pe(e)}),Mo(c,"chatgpt_edit_prompt"),L(!0))},[c,gs,e]),Qn=d.useCallback(()=>{L(!1)},[]),{hasConnections:Ps}=Ao(),{onChangeRating:Xn}=oi({clientThreadId:e,currentModelConfig:cs}),Yn=n=>{var U;if(!r)return;const l=(U=r.clientMetadata)==null?void 0:U.rating,_=(l==="thumbs_up"?"thumbsUp":l==="thumbs_down"?"thumbsDown":l)===n?null:n;if(Xn({nodeId:r.id,messageId:r.id,rating:_}),_){const K=Ps&&w.some(_e=>{var ee;return _e.type!==Is&&((ee=_e.messages)==null?void 0:ee.some(Bo))});Ss.logEventWithStatsig(_==="thumbsDown"?"Message Feedback Thumbs Down Clicked":"Message Feedback Thumbs Up Clicked","chatgpt_thumb_feedback",G(G({id:r.id,threadId:Pe(e),model:p,rating:_},Ps?{isCATriggered:K}:{}),T?{isSidebar:!0}:{}))}he(_==="thumbsDown")},[Jn]=d.useState(()=>Date.now()),Ns=Ro(e),Ds=(rt=ii(e))==null?void 0:rt.value,Zn=Ds===es.STREAMING,ea=Ds===es.REALTIME,sa=As!=null,ta=kn(As),na=en.useState(n=>en.isReplayInProgress(n,qn)),ae=!On&&ta||me||ea||na&&o,hs=Mn(),Us=d.useRef(!1),aa=jo({clientThreadId:e}),oa=ri(e,r)&&!aa,[,ia]=eo(),{isOpen:$e}=sn(),Gs=Fo(),ye=y(C==null?void 0:C.messages.filter(Po)),ps=li({clientThreadId:e,threadContent:(lt=Se==null?void 0:Se.content)!=null?lt:null,query:ye?ts(ye):null,triggeredSearch:q,messageGroups:ne,allMessages:v}),Vs=ks(c)&&He&&(!z||z.length===0||z.includes(Fe.Search)),we=Vs&&ps.showNavlinksWidget,Os=u.filter(Kt),ra=we&&Os.length===0&&!I,Hs=((ct=k==null?void 0:k.author.metadata)==null?void 0:ct.real_author)==="onboarding",Bs=P&&He&&we&&ps.showLongList;d.useEffect(()=>{const l=new URLSearchParams(window.location.search).get("message");!(l!=null&&js.includes(l))||!Z.current||(Z.current.scrollIntoView({behavior:"instant"}),ia(_=>(_.delete("message"),_),{replace:!0,preventScrollReset:!0}))},[]),d.useEffect(()=>{if(x)return;const b=new URLSearchParams(window.location.search).get("message")!=null;if(Us.current||b||g===void 0||!J||!Z.current||Gs||Hs||Bs){g==="finalAgentTurn"&&o&&ue(e,_=>{_.scrollToMessageId=void 0});return}(js.includes(g)||g==="finalAgentTurn"&&o)&&(Us.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(Z.current)if(g==="finalAgentTurn"&&o)Z.current.scrollIntoView({behavior:"instant",block:"end"}),ue(e,_=>{_.scrollToMessageId=void 0});else{const _=Z.current.offsetHeight;let U=0;$e?U=-8:P?U=-1*Ts:_>bn&&(U=bn-_);const K=ci(zt(c,e)).pinnedWidgetHeight$();K!=null&&(U+=K+Ts),Z.current.style.scrollMarginTop="".concat(U+Ts,"px"),Z.current.scrollIntoView({behavior:"smooth"})}})}))},[g,Z.current,$e,Gs,Hs,Bs]);const{showDebugConversationTurns:la}=yn(),ca=!We&&!Le&&!is&&!j,da=(S==null?void 0:S.author.role)===W.Assistant?S:null,ua=(ut=(dt=S==null?void 0:S.metadata)==null?void 0:dt.system_hints)==null?void 0:ut.includes(Fe.Research),ma=(gt=(mt=S==null?void 0:S.metadata)==null?void 0:mt.system_hints)==null?void 0:gt.includes(Fe.Agent);di({isCompletionRequestInProgress:ae,isUserTurn:j,message:da});const{isOpen:ga}=sn(),ha=ui(),ze=mi(Ms),pa=No(n=>n.voiceFeedbackThread),Ls=Ns===pa,fa=(ht=r==null?void 0:r.metadata)==null?void 0:ht.async_source,Ke=o&&sa,xe=qe||ae||Zn,Ws=$.length===0&&u.some(Do),Qe=!ce&&!Ws&&!We&&!Le&&!ze&&!ga&&h.role!==W.Developer&&!(h.role===W.User&&m)&&!(o&&Ls&&xe)&&!(Ke&&xe)&&!(o&&qe&&fa)&&!(xe&&I)&&!((pt=r==null?void 0:r.metadata)!=null&&pt.is_auto_proceed_message)&&!((ft=r==null?void 0:r.metadata)!=null&&ft.is_takeover_ended_message)&&!ra,ba=!Qe&&!(Ke&&xe)&&(We||Le)&&!T,xa=u.some(n=>Uo(n)===Go.l1239dk1),fs=Ee(e,n=>{var _,U;const l=new Set,b=F.getParentPromptNode(n,O.id);return(U=(_=b==null?void 0:b.message.metadata)==null?void 0:_.attachments)==null||U.forEach(K=>{var _e,ee,Re;(_e=K.mime_type)!=null&&_e.startsWith("image/")||l.add((Re=(ee=K.context_connector_info)==null?void 0:ee.context_connector)!=null?Re:"file")}),l}),bs=Vo(),xs=Qt(c,"110789670");let ve;bs.isLoading?ve=void 0:bs.canUpgradeGDrive&&fs.has(ss.GDRIVE)&&xs.get("enabled",!1)?ve=ss.GDRIVE:bs.canUpgradeSharepoint&&fs.has(ss.O365_BUSINESS)&&xs.get("enabled",!1)?ve=ss.O365_BUSINESS:fs.has("file")&&xs.get("enabled",!1)&&(ve="general");const va=Ke&&!ae&&!T&&!We&&!Le&&!xa&&(ge||gi(c)||D||oe||!!ve),ke=r!=null&&(!Y||Vn||N||ds)&&!ze&&!Rs&&!is&&!((bt=r.metadata)!=null&&bt.b1de6e2_s),qs=qe||ae,[_a,Ia]=d.useState(!1),Sa=!!((xt=k==null?void 0:k.metadata)!=null&&xt.dictation&&((vt=k==null?void 0:k.metadata)!=null&&vt.dictation_asset_pointer)&&!((_t=k==null?void 0:k.metadata)!=null&&_t.dictation_edited)),Ta=!!(!te||_a||(It=k==null?void 0:k.metadata)!=null&&It.audio_paragen_result||tn(k==null?void 0:k.id)),$s=Sa&&!Ta,zs=$s&&(!Y||ds)&&ke&&!qs&&!T&&!$e&&k!=null&&He&&Ie(c,"51772912"),ya=hi(k==null?void 0:k.id,zs),Ks=zs&&ya,Xe=!ze&&ca&&o&&(ms==null?void 0:ms.num_variants_in_stream)===2&&re.length<=2&&!((St=r==null?void 0:r.clientMetadata)!=null&&St.inlineComparisonRating)&&!Hn&&!$s&&!tn(k==null?void 0:k.id),Qs=!Ks&&(!Y||ds)&&ke&&(Ke||o&&Ls)&&!qs&&!T&&!$e&&!I,Xs=!((ae||qe)&&o)&&re.length>1&&!Xe,Ys=j&&u.some(n=>{var l;return(l=nn(n))==null?void 0:l.shouldHideContent}),wa=j&&Te!=null&&Ns!=null&&!ze&&!$n&&!Ys&&!Rs&&!ua&&!ma&&!T,Ca=r!=null&&Xt.getAudioAssetPointers(r).length>0,Ea=r!=null&&((yt=(Tt=r.clientMetadata)==null?void 0:Tt.disclaimers)!=null?yt:[]).length===0&&!T&&(!is||Ca),ka=as(c)&&Vs,Js=d.useCallback(n=>{var l;ue(e,b=>{Es.setCurrentBranch(b,re[n])}),Ss.logEvent("Change Active Node",{intent:"toggle_between"}),Ie(c,"4126691920")&&pi({parent_prompt_id:(l=be==null?void 0:be.id)!=null?l:"",prev_branch_id:re[Be],next_branch_id:re[n]},Pe(e))},[e,re,Be,be==null?void 0:be.id,c]),Ma=fi(h,u,la),Aa=I&&bi(u,o),{toggleThreadSidebar:Zs}=Oo(),Ye=r==null?void 0:r.id,et=d.useCallback(()=>{Ye&&Zs({type:"retrievalResults",clientThreadId:e,turnIndex:t,messageId:Ye})},[Ye,Zs,e,t]),Me=!1,st=d.useMemo(()=>xi(h,Oe,!!pe),[h,Oe,pe]),Ra=d.useMemo(()=>st&&!Me,[st,Me]),ja=d.useMemo(()=>vi(h,!!pe),[pe,h]),tt=Ie(c,"2137702454"),Fa=d.useMemo(()=>h.role!==W.User&&Oe&&(tt||Me),[h,Oe,tt,Me]),Pa=Ho()&&CSS.supports("content-visibility: auto")&&!j&&Qt(c,"1011775750").get("enabled",!1)&&!_i(u),Na=d.useMemo(()=>u.some(n=>{var l;return((l=nn(n))==null?void 0:l.canRetry)===!1}),[u]),Da=(wt=r==null?void 0:r.metadata)==null?void 0:wt.n7jupd_button_type,Ua=I&&r!=null&&r.id!=null&&!Da,Ga=I&&o&&xe,Va=I&&o;if(!Ma&&!Xe&&!we)return Fs?s.jsx("div",{style:ws()}):null;if(Aa||R)return null;const Oa=(Ct=S==null?void 0:S.metadata)!=null&&Ct.followup_prompts?S.metadata.followup_prompts.map(n=>({text:n,type:Ii.Reply})):[],Ha=(Et=S==null?void 0:S.metadata)==null?void 0:Et.category_suggestions,Ba=(kt=S==null?void 0:S.metadata)==null?void 0:kt.action_suggestions,La=(Mt=S==null?void 0:S.metadata)==null?void 0:Mt.pineapple_tool_suggestions,Wa=!u.some(n=>Xt.getAudioAssetPointers(n).length>0)&&!pe&&!Na,qa=!ae&&u.some(n=>{var l,b;return n.author.role===W.Assistant&&((b=(l=n.metadata)==null?void 0:l.onboarding)==null?void 0:b.main_usages)}),vs=u.find(n=>{var l,b;return!!((b=(l=n.metadata)==null?void 0:l.onboarding)!=null&&b.examples)}),_s=(Rt=(At=vs==null?void 0:vs.metadata)==null?void 0:At.onboarding)==null?void 0:Rt.examples,nt=!Ys&&(!o||!ae);if(!o&&Os.length===0&&!I&&!we)return null;let Ae="none";j&&us&&(Ae="first");const $a=C==null?void 0:C.messages.some(Kt);j&&!us&&($a?Ae="large":Ae="none"),o&&(Ae="last");const za=(()=>{if(j&&!Qe&&as(c)&&A)return"mb-4";if(j&&!Qe&&!T)return"mb-10";if(!j&&T&&o)return"pb-[40px]"})(),Ka=Ie(c,"1424158285");return s.jsx(Si.Provider,{value:He,children:s.jsxs(Ti,{children:[s.jsx(yi,{dateHeaderType:f,turn:h}),s.jsxs("article",{className:X("text-token-text-primary w-full focus:outline-none",Pa&&"[content-visibility:auto] supports-[content-visibility:auto]:[contain-intrinsic-size:auto_100lvh]",!x&&g==="finalAgentTurn"&&J?"opacity-0":"",{hidden:Ve&&us},j?"scroll-mt-(--header-height)":"scroll-mt-[calc(var(--header-height)+min(200px,max(70px,20svh)))]"),tabIndex:-1,style:Fs?ws():void 0,ref:Z,dir:"auto","data-turn-id":h.id,"data-testid":"conversation-turn-".concat(t),"data-scroll-anchor":!x&&o,"data-turn":j?"user":"assistant",children:[s.jsx(wi,{role:h.role,gizmo:ls}),s.jsx(Ci,{role:h.role,children:s.jsxs(Ei,{horizontalPadding:Xe?"none":"standard",verticalPadding:Ae,children:[Xe?s.jsxs(s.Fragment,{children:[s.jsx(cr,G({isFeedbackEnabled:ke,variantIds:re,conversationTurnMountTime:Jn},a)),zn&&s.jsx("div",{className:"mt-4 flex w-full justify-center",children:s.jsxs(Tn,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{Sn.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[s.jsx(ki,{className:"text-token-text-secondary me-1"}),s.jsx(Q,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):s.jsxs(An,{tabIndex:-1,className:X("group/turn-messages focus-visible:outline-hidden",we&&"super-widget-visible",za,zi({isUserTurn:j})),children:[Un&&s.jsx(Mi,{gizmo:ls}),we&&s.jsx(Ai,{clientThreadId:e,query:ye?ts(ye):null,turnIndex:t,isRequestActive:hs,isLastTurnInConversation:o,state:ps,className:"mb-4!"}),Fa&&s.jsx(Ri,{handleShowRetrievalResults:et,clientThreadId:e,turnIndex:t,responseComplete:!xe,className:"mb-6"}),!j&&s.jsx(ur,{messages:u,clientThreadId:e,gizmoId:fe==null?void 0:fe.gizmo.id}),!j&&u.some(n=>{var l;return!!((l=n.metadata)!=null&&l.async_task_message_label)})&&s.jsx(ji,{message:u.find(n=>{var l;return!!((l=n.metadata)!=null&&l.async_task_message_label)}),clientThreadId:e}),ha&&j&&s.jsx(mr,{clientThreadId:e,messages:u}),ce&&Te?s.jsx(fn,{message:Te,clientThreadId:e,onRequestCompletion:i,onExitEdit:Qn,disabled:hs}):s.jsx(ys,le(G({allMessages:v,groupedMessagesToRender:ne,allGroupedMessages:w},a),{isUserTurn:j,isFinalUserTurn:Bn,isFinalAssistantTurn:Ln,isWithinFirstAssistantTurns:Wn,isCompletionRequestInProgress:ae,isFeedbackEnabled:ke,isFinalTurn:o,isGlauxTurn:Me,hasActiveRequest:hs,isAgentTurn:I,isKAUR1BR5:B,query:ye?ts(ye):null,wasInterrupted:Ws,superWidgetImages:(jt=Se==null?void 0:Se.content.widgets.images)!=null?jt:null,lastAgentMetadataNode:H,hideSearchGPTQuery:ka})),Ra&&(Ka&&ja?s.jsx(gr,{turnIndex:t,clientThreadId:e,variant:"bottom"}):s.jsx(Fi,{handleShowRetrievalResults:et,clientThreadId:e,turnIndex:t,responseComplete:!xe})),Ua&&s.jsx(Pi,{message:r,clientThreadId:e,turnIndex:t,referenceMessageId:r.id,responseComplete:!o||!ae}),qa&&s.jsx(Ni,{clientThreadId:e}),_s&&_s.length>0&&!ae&&s.jsx(Di,{clientThreadId:e,examples:_s}),Qe&&s.jsx(Ui,{isUserTurn:j,alwaysShow:!0,children:j?T?null:s.jsx(Gi,{activeVariantIndex:Be,clientThreadId:e,numVariants:re.length,onAnticipateEdit:fn.prefetch,onChangeIndex:Js,onEnterEdit:Kn,showCopyButton:nt,showEditMessageButton:wa,showPagination:Xs,turnIndex:t}):s.jsxs(s.Fragment,{children:[s.jsx(Vi,{activeVariantIndex:Be,clientThreadId:e,conversationMode:Ms,lastMessage:r,messages:u,numVariants:re.length,onChangeIndex:Js,onRate:Yn,showCanvasButton:oa,showCopyButton:nt,showPagination:Xs,showPlayButton:Ea,showRatingButtons:ke,showRegenerateButton:Wa,turn:h,turnIndex:t,parentPrompt:be,isAgentTurn:I,isKAUR1BR5:B}),s.jsx(an,{clientThreadId:e,message:r,turnIndex:t}),Qs&&s.jsx(Oi,{canShowInlineMessageFeedback:de,clientThreadId:e,messageForRating:r}),!1]})}),Ga&&s.jsx(Hi,{clientThreadId:e}),Va&&s.jsx(Bi,{clientThreadId:e,messages:u}),ba&&s.jsx(an,{clientThreadId:e,message:r,turnIndex:t}),Qs&&s.jsx(Li,{canShowInlineMessageFeedback:de,clientThreadId:e,messageForRating:r,allGroupedMessages:w,currentModelId:p}),s.jsx(so,{mode:"wait",children:Ks&&s.jsx(Wi,{lastUserMessageId:k.id,setIsDismissed:Ia})}),va&&(ve?s.jsx(qi,{clientThreadId:e,connectorToUpsell:ve,analyticsMetadata:ie}):s.jsx($i,{followups:Oa,actionSuggestions:Ba,pineappleToolSuggestions:La,categorySuggestions:Ha,clientThreadId:e,lastMessageId:Ye,analyticsMetadata:ie,isTatertotFollowupsEnabled:oe}))]}),s.jsx(Ki,{clientThreadId:e,turn:h,isFinalTurn:o}),s.jsx(Qi,{clientThreadId:e,turn:h})]})})]})]})})}const pr=({clientThreadId:a,turn:t,turnIndex:o,conversationTurnWrapperRef:e})=>{const i=Xi();d.useEffect(()=>{if(!i)return;const p=new IntersectionObserver(g=>{g.forEach(f=>{f.isIntersecting?ue(a,m=>{var c;m.turnIdsInViewpoint=[...(c=m.turnIdsInViewpoint)!=null?c:[],{turnId:t.id,turnIndex:o,role:t.role}]}):ue(a,m=>{var c;m.turnIdsInViewpoint=(c=m.turnIdsInViewpoint)==null?void 0:c.filter(({turnId:E})=>E!==t.id)})})},{root:null,threshold:.1});return e.current&&p.observe(e.current),()=>{ue(a,g=>{var f;g.turnIdsInViewpoint=(f=g.turnIdsInViewpoint)==null?void 0:f.filter(({turnId:m})=>m!==t.id)}),p.disconnect()}},[a,e,i,t.id,t.role,o])},kr=Za.memo(hr);function Mr(){const[a,t]=wn(i=>[En(i),Cn(i)]),o=er(),e=sr();return a&&!t&&!o&&!e}function Dn(){const a=Ge(),t=os(()=>Rn());return typeof t=="boolean"?t:Wo(a,"694761886").get("news_tab_enabled",!1)}function Ar({className:a,textClassName:t}){const o=Ge(),e=as(o),i=os(()=>Ne()),p=Dn(),g=qo.useStore(),f=$o(),m=ks(o);d.useEffect(()=>{!p&&i==="news"&&Ne.set("answer")},[p,i]);function c(E){if(Ne.set(E),E!=="answer"){const x=g.getActiveSystemHintType();x&&x!==Fe.Search&&f(null)}}return m?e?s.jsx(or,{selectedTab:i,selectTab:c,className:a,textClassName:t,showNewsTab:p}):s.jsxs("div",{className:X("flex gap-8.5",a),children:[s.jsx(je,{className:t,$selected:i==="answer",onClick:()=>c("answer"),children:s.jsx(Q,G({},Ce.chatTab))}),s.jsx(je,{className:t,$selected:i==="web",onClick:()=>c("web"),children:s.jsx(Q,G({},Ce.linksTab))}),s.jsx(je,{className:t,$selected:i==="images",onClick:()=>c("images"),children:s.jsx(Q,G({},Ce.imagesTab))}),s.jsx(je,{className:t,$selected:i==="videos",onClick:()=>c("videos"),children:s.jsx(Q,G({},Ce.videosTab))}),p&&s.jsx(je,{className:t,$selected:i==="news",onClick:()=>c("news"),children:s.jsx(Q,G({},Ce.newsTab))})]}):null}var _n;const je=Cs.button(_n||(_n=Ze(["\n  ","\n"])),({$selected:a})=>a?"text-token-text-primary font-medium":"text-token-text-tertiary hover:text-token-text-secondary"),fr={answer:()=>null,web:ar,images:Pn,videos:Fn,news:jn},br={answer:()=>null,web:nr,images:Pn,videos:Fn,news:jn};function xr({userMessages:a,superWidgetMessageContents:t,tab:o,scrollToMessageId:e,isNewsTabEnabled:i}){const p=Ge(),g=d.useRef({});function f(x,M="smooth"){const A=g.current[x];A&&A.scrollIntoView({behavior:M,block:"start"})}if(d.useEffect(()=>{requestAnimationFrame(()=>{if(a.length>0){const x=a[a.length-1];x&&f(x.id,"instant")}})},[]),d.useEffect(()=>{setTimeout(()=>{e&&f(e)},50)},[e]),o==="news"&&!i)return null;const m=as(p),c=m?br[o]:fr[o],E=o==="web"||o==="videos"||o==="news";return s.jsx("div",{className:X("flex w-full flex-col pt-2",m&&"thread-sm:px-2 px-4",E?"gap-4":"gap-10"),children:tr(a.length,x=>s.jsxs("div",{className:"w-full",children:[x>0&&s.jsx("hr",{className:X("border-heavy w-full",m?"pb-4.5":"pb-1.5")}),s.jsx("div",{className:X(m?E?"mb-4":"mb-6":E?"mb-2.5":"mb-6","flex items-center text-base",m?"scroll-mt-6":"scroll-mt-4",x>0&&"mt-2.5"),ref:M=>{g.current[a[x].id]=M},children:s.jsx(vr,{userMessage:a[x],tab:o,isKirklandEnabled:m})}),t[x]?s.jsx(c,{content:t[x],turnIndex:x}):s.jsx("div",{style:ws(),children:s.jsx("div",{className:"result-streaming pulse",children:s.jsx("span",{})})})]},x))})}function vr({userMessage:a,tab:t,isKirklandEnabled:o}){const e=ts(a);return e?o?s.jsx(ir,{queryText:e,tabType:t,searchIt:s.jsx(rr,{href:lr(e,t)})}):s.jsx("div",{dir:"auto",className:"text-token-text-tertiary flex max-w-[var(--user-chat-width,70%)] min-w-0 text-start text-sm",children:s.jsx(Q,le(G({},Ce.resultsFor),{values:{prefix:i=>s.jsx("span",{className:"shrink-0",children:i}),query:s.jsx("span",{className:"min-w-0 flex-1 truncate",children:e}),trailingQuote:i=>s.jsx("span",{"aria-hidden":"true",className:"shrink-0",children:i})}}))}):null}function Rr({clientThreadId:a,children:t}){var E,x;const o=Ge(),e=os(()=>Ne()),i=Dn(),[p,g,f]=Ee(a,M=>[F.getUserMessages(M).filter(A=>{var T;return!((T=A.metadata)!=null&&T.is_visually_hidden_from_conversation)}),F.getSuperWidgetMessages(M),M==null?void 0:M.scrollToMessageId]),m=g[g.length-1],c=(x=(E=m==null?void 0:m.content)==null?void 0:E.widgets)==null?void 0:x.news_tab_enabled;return d.useEffect(()=>{Rn.set(typeof c=="boolean"?c:void 0)},[c]),d.useEffect(()=>{!i&&e==="news"&&Ne.set("answer")},[i,e]),ks(o)?s.jsxs("div",{children:[s.jsx("div",{id:"mini-chat-content",className:e==="answer"?"block":"hidden",children:t}),s.jsx(An,{children:e!=="answer"&&(e!=="news"||i)&&s.jsx(xr,{userMessages:p,superWidgetMessageContents:g.map(M=>M.content),tab:e,scrollToMessageId:f,isNewsTabEnabled:i},e)})]}):t}const Ce=In({chatTab:{id:"CSsJbp",defaultMessage:"Chat"},linksTab:{id:"U43uU/",defaultMessage:"Links"},imagesTab:{id:"ZY9oIP",defaultMessage:"Images"},videosTab:{id:"C8mH8+",defaultMessage:"Videos"},newsTab:{id:"RxIkHj",defaultMessage:"News"},resultsFor:{id:"V5ZXix",defaultMessage:"<prefix>Results for “</prefix>{query}<trailingQuote>”</trailingQuote>"}});export{kr as C,Rr as S,Ar as a,Mr as u};
//# sourceMappingURL=x7ghsbi61l9frihs.js.map
