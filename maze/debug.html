<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆè°ƒè¯• - NOS MAZE</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        .status-box {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #ccc;
        }
        .status-box.success {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        .status-box.error {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        .test-canvas {
            border: 2px solid #333;
            margin: 10px 0;
            background: white;
        }
        button {
            background: #000;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #333;
        }
        pre {
            background: #1a1a1a;
            color: #10b981;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        h2 {
            margin-top: 30px;
        }
    </style>
    <script src="i18n.js?v=4"></script>
</head>
<body>
    <h1>ğŸ” NOS MAZE è°ƒè¯•å·¥å…·</h1>
    
    <div id="status"></div>
    
    <h2>æµ‹è¯•æ­¥éª¤</h2>
    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0;">
        <h3 style="margin-top: 0;">ğŸ“± æ‰‹æœºç«¯è°ƒè¯•è¯´æ˜</h3>
        <p><strong>å¦‚æœæ¸¸æˆCanvasç©ºç™½ï¼Œè¯·ç‚¹å‡»ä¸‹æ–¹"è¿›å…¥æ¸¸æˆ(è°ƒè¯•æ¨¡å¼)"</strong></p>
        <p>è°ƒè¯•æ¨¡å¼ä¼šåœ¨å±å¹•åº•éƒ¨æ˜¾ç¤ºç»¿è‰²/çº¢è‰²çš„Consoleæ—¥å¿—ï¼Œå¯ä»¥çœ‹åˆ°å…·ä½“å“ªé‡Œå‡ºé”™äº†ã€‚</p>
    </div>
    
    <button onclick="runTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
    <button onclick="testCanvas()">æµ‹è¯•Canvas</button>
    <button onclick="testTranslations()">æµ‹è¯•ç¿»è¯‘</button>
    <button onclick="setLanguage('zh')">è®¾ç½®ä¸­æ–‡</button>
    <button onclick="setLanguage('en')">è®¾ç½®è‹±æ–‡</button>
    <button onclick="window.location.href='game.html?mode=just-maze&size=mini'">è¿›å…¥æ¸¸æˆ</button>
    <button onclick="window.location.href='game.html?mode=just-maze&size=mini&debug=1'" style="background:#f00; color:#fff">è¿›å…¥æ¸¸æˆ(è°ƒè¯•æ¨¡å¼)</button>
    
    <div id="testResults"></div>
    
    <h2>Canvasæµ‹è¯•</h2>
    <canvas id="testCanvas" class="test-canvas" width="300" height="300"></canvas>
    
    <h2>ç³»ç»Ÿä¿¡æ¯</h2>
    <div id="systemInfo"></div>
    
    <script>
        const log = [];
        
        function addStatus(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status-box ${type}`;
            div.textContent = message;
            document.getElementById('status').appendChild(div);
            log.push(`[${type.toUpperCase()}] ${message}`);
        }
        
        function setLanguage(lang) {
            localStorage.setItem('maze-lang', lang);
            window.__MAZE_PRELOAD_LANG__ = lang;
            addStatus(`âœ… è¯­è¨€å·²è®¾ç½®ä¸º: ${lang === 'zh' ? 'ä¸­æ–‡' : 'è‹±æ–‡'}`, 'success');
            addStatus('è¯·åˆ·æ–°é¡µé¢æˆ–é‡æ–°è¿è¡Œæµ‹è¯•', 'info');
            showSystemInfo();
        }
        
        function showSystemInfo() {
            const savedLang = localStorage.getItem('maze-lang');
            const preloadLang = window.__MAZE_PRELOAD_LANG__;
            
            const info = {
                'User Agent': navigator.userAgent,
                'å±å¹•å°ºå¯¸': `${window.screen.width} x ${window.screen.height}`,
                'è§†å£å°ºå¯¸': `${window.innerWidth} x ${window.innerHeight}`,
                'è®¾å¤‡åƒç´ æ¯”': window.devicePixelRatio,
                'è§¦æ‘¸æ”¯æŒ': 'ontouchstart' in window ? 'æ˜¯' : 'å¦',
                'LocalStorageè¯­è¨€': savedLang || 'æœªè®¾ç½®',
                'é¢„åŠ è½½è¯­è¨€': preloadLang || 'æœªè®¾ç½®',
                'MAZE_TRANSLATIONS': typeof window.MAZE_TRANSLATIONS !== 'undefined' ? 'å·²åŠ è½½' : 'æœªåŠ è½½'
            };
            
            let html = '<pre>';
            for (const [key, value] of Object.entries(info)) {
                html += `${key}: ${value}\n`;
            }
            html += '</pre>';
            
            document.getElementById('systemInfo').innerHTML = html;
        }
        
        function testCanvas() {
            addStatus('å¼€å§‹æµ‹è¯•Canvas...', 'info');
            
            const canvas = document.getElementById('testCanvas');
            if (!canvas) {
                addStatus('âŒ Canvaså…ƒç´ æœªæ‰¾åˆ°', 'error');
                return;
            }
            
            addStatus('âœ… Canvaså…ƒç´ å·²æ‰¾åˆ°', 'success');
            
            const ctx = canvas.getContext('2d');
            if (!ctx) {
                addStatus('âŒ æ— æ³•è·å–2Dä¸Šä¸‹æ–‡', 'error');
                return;
            }
            
            addStatus('âœ… 2Dä¸Šä¸‹æ–‡è·å–æˆåŠŸ', 'success');
            
            // ç»˜åˆ¶æµ‹è¯•å›¾æ¡ˆ
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, 300, 300);
            
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 2;
            
            // ç»˜åˆ¶ç½‘æ ¼
            for (let i = 0; i <= 300; i += 30) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, 300);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(300, i);
                ctx.stroke();
            }
            
            // ç»˜åˆ¶åœ†ç‚¹
            ctx.fillStyle = '#10b981';
            ctx.beginPath();
            ctx.arc(50, 50, 10, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = '#ef4444';
            ctx.beginPath();
            ctx.arc(250, 250, 10, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = '#3b82f6';
            ctx.beginPath();
            ctx.arc(150, 150, 15, 0, Math.PI * 2);
            ctx.fill();
            
            addStatus('âœ… Canvasç»˜åˆ¶æµ‹è¯•å®Œæˆ', 'success');
        }
        
        function testTranslations() {
            addStatus('å¼€å§‹æµ‹è¯•ç¿»è¯‘ç³»ç»Ÿ...', 'info');
            
            if (typeof window.MAZE_TRANSLATIONS === 'undefined') {
                addStatus('âŒ MAZE_TRANSLATIONSæœªå®šä¹‰', 'error');
                return;
            }
            
            addStatus('âœ… MAZE_TRANSLATIONSå·²åŠ è½½', 'success');
            
            if (typeof window.getMazeTranslation !== 'function') {
                addStatus('âŒ getMazeTranslationå‡½æ•°æœªå®šä¹‰', 'error');
                return;
            }
            
            addStatus('âœ… getMazeTranslationå‡½æ•°å·²å®šä¹‰', 'success');
            
            // æµ‹è¯•ç¿»è¯‘
            const testKey = 'game.steps';
            const zhTranslation = window.getMazeTranslation('zh', testKey);
            const enTranslation = window.getMazeTranslation('en', testKey);
            
            addStatus(`ä¸­æ–‡ç¿»è¯‘: "${testKey}" = "${zhTranslation}"`, zhTranslation !== testKey ? 'success' : 'error');
            addStatus(`è‹±æ–‡ç¿»è¯‘: "${testKey}" = "${enTranslation}"`, enTranslation !== testKey ? 'success' : 'error');
            
            // æ£€æŸ¥é¢„åŠ è½½è¯­è¨€å’ŒLocalStorage
            const preloadLang = window.__MAZE_PRELOAD_LANG__;
            const storedLang = localStorage.getItem('maze-lang');
            
            addStatus(`LocalStorageè¯­è¨€: ${storedLang || 'æœªè®¾ç½®'}`, storedLang ? 'success' : 'error');
            addStatus(`é¢„åŠ è½½è¯­è¨€: ${preloadLang || 'æœªè®¾ç½®'}`, preloadLang ? 'success' : 'error');
            
            if (!storedLang) {
                addStatus('âš ï¸ è¯­è¨€æœªè®¾ç½®ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è®¾ç½®è¯­è¨€', 'error');
            }
        }
        
        function runTests() {
            document.getElementById('status').innerHTML = '';
            log.length = 0;
            
            addStatus('ğŸš€ å¼€å§‹è¿è¡Œæµ‹è¯•...', 'info');
            
            testTranslations();
            testCanvas();
            showSystemInfo();
            
            addStatus('âœ… æ‰€æœ‰æµ‹è¯•å®Œæˆ', 'success');
            
            // æ˜¾ç¤ºæ—¥å¿—
            const logDiv = document.createElement('div');
            logDiv.innerHTML = '<h2>æµ‹è¯•æ—¥å¿—</h2><pre>' + log.join('\n') + '</pre>';
            document.getElementById('testResults').innerHTML = logDiv.outerHTML;
        }
        
        // é¡µé¢åŠ è½½æ—¶è¿è¡Œæµ‹è¯•
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(runTests, 100);
        });
    </script>
</body>
</html>

