# 開發者功能說明

## 概述

開發者功能是專門為開發者設計的測試工具，允許自動化測試迷宮遊戲的性能、時間和步數。

## 啟用開發者功能

### 1. 在 Supabase 中添加開發者標籤

首先，需要在 Supabase 資料庫中執行遷移腳本：

```bash
# 進入 Supabase 專案目錄
cd supabase

# 執行遷移腳本
psql -h <your-supabase-host> -U postgres -d postgres -f migrations/add_developer_flag.sql
```

或者直接在 Supabase Dashboard 的 SQL Editor 中執行：

```sql
-- 添加 is_developer 欄位
ALTER TABLE profiles 
ADD COLUMN IF NOT EXISTS is_developer BOOLEAN DEFAULT false;

-- 將特定用戶設為開發者
UPDATE profiles 
SET is_developer = true 
WHERE username = 'your_username';
```

### 2. 設置開發者權限

在 Supabase Dashboard 中：
1. 進入 Table Editor
2. 選擇 `profiles` 表
3. 找到你的用戶記錄
4. 將 `is_developer` 欄位設為 `true`

## 開發者功能特性

### 1. 自動跑迷宮

- **最短路徑算法**：使用 BFS（廣度優先搜索）算法自動找到從起點到終點的最短路徑
- **自動行走**：按照最短路徑自動完成迷宮
- **可調速度**：可以自定義自動行走的速度（50ms - 1000ms 每步）

### 2. 自動完成模式

- **連續完成**：開啟後會自動完成所有迷宮，直到模式結束
- **適用模式**：
  - Race Mode（競速模式）：自動完成指定數量的迷宮
  - Dark Mode（黑暗模式）：自動完成單個迷宮

### 3. 記錄控制

- **伺服器記錄開關**：可以選擇是否將測試結果記錄到伺服器
- **測試隔離**：不記錄時，測試數據不會影響排行榜

## 使用方法

### 1. 進入遊戲

以開發者身份登入後，進入任何遊戲模式（Just Maze、Faultless、Race、Dark）。

### 2. 開啟開發者工具

在遊戲畫面中，點擊右下角的 🛠️ 按鈕，開啟開發者工具面板。

### 3. 配置設定

在開發者工具面板中：

- **移動速度**：拖動滑桿調整自動行走的速度
- **自動完成所有迷宮**：勾選後會連續完成所有迷宮
- **記錄到伺服器**：取消勾選可以避免測試數據記錄到排行榜

### 4. 開始自動測試

點擊「自動解迷宮」按鈕，系統會：

1. 計算從當前位置到終點的最短路徑
2. 按照設定的速度自動行走
3. 完成後顯示時間和步數
4. 如果開啟「自動完成所有迷宮」，會自動開始下一個迷宮

### 5. 停止測試

點擊「停止」按鈕可以隨時停止自動測試。

## 技術實現

### 檔案結構

```
scripts/game/
├── dev/
│   ├── autoSolver.js      # 自動解迷宮核心邏輯
│   └── devPanel.js        # 開發者工具UI面板
├── utils/
│   └── pathfinder.js      # BFS 尋路算法
└── index.js               # 整合開發者功能
```

### 核心算法

**BFS 尋路算法** (`pathfinder.js`)：
- 使用廣度優先搜索保證找到最短路徑
- 考慮迷宮牆壁約束
- 返回移動序列供自動執行

**自動執行** (`autoSolver.js`)：
- 按照設定的速度執行移動
- 支援暫停/繼續
- 支援自動完成多個迷宮

### 資料流

1. 用戶登入 → AuthService 檢查 `is_developer` 標籤
2. 如果是開發者 → 初始化開發者工具
3. 點擊自動解迷宮 → 計算最短路徑 → 自動執行
4. 完成後 → 根據設定決定是否記錄到伺服器

## 注意事項

1. **僅限開發者使用**：普通用戶無法看到開發者工具按鈕
2. **測試模式隔離**：關閉「記錄到伺服器」時，測試數據不會影響排行榜
3. **速度限制**：移動速度限制在 50ms - 1000ms 之間，避免過快或過慢
4. **自動完成限制**：
   - Just Maze 和 Faultless 模式：只完成單個迷宮
   - Race 模式：完成指定數量或無限迷宮
   - Dark 模式：只完成單個迷宮

## 開發參考

### 添加新的開發者功能

1. 在 `scripts/game/dev/` 目錄下創建新的功能模組
2. 在 `scripts/game/index.js` 中導入並整合
3. 在開發者面板中添加對應的 UI 控制
4. 更新此文檔說明新功能

### 修改權限檢查

開發者權限檢查在以下位置：
- `scripts/auth/authService.js` - enrichUser 方法
- `scripts/game/index.js` - handleAuthStateChange 方法

## 問題排查

### 問題：看不到開發者工具按鈕

**解決方法**：
1. 確認已在 Supabase 中將用戶的 `is_developer` 設為 `true`
2. 重新登入遊戲
3. 檢查瀏覽器控制台是否有錯誤訊息

### 問題：自動解迷宮失敗

**解決方法**：
1. 檢查控制台是否顯示「無法找到路徑」
2. 確認當前位置和終點之間有可行路徑
3. 嘗試重新生成迷宮

### 問題：測試數據仍然記錄到排行榜

**解決方法**：
1. 確認已取消勾選「記錄到伺服器」選項
2. 檢查控制台是否顯示「開發者模式：不記錄到伺服器」
3. 清除瀏覽器快取後重試

